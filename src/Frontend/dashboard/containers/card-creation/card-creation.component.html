<sb-top-nav title="Bot Builder"></sb-top-nav>








<div class="new_chat_boat_1 conten_set">
  <div class="new_chat_boat_2">
    <div class="new_chat_left">
      <!-- <div class="new_chat_left_close">
          <button class="btn btn_clear btn_icon_mob">
            <i class="uil uil-times-circle"></i>
          </button>
        </div> -->



      <div class="sidebar" *ngIf="activeSidebar === 'main'">
        <!-- <div class="logo">Logo.</div> -->

        <div class="sidebar-item purple">
          <div class="item-header">
            <i class="uil uil-comment-alt-dots"></i>
            <div>
              <div class="title">Send Message</div>
              <div class="desc">No response expected from the user</div>
            </div>
            <i class="uil" [ngClass]="{ 'uil-angle-down': isOpen.send, 'uil-angle-right': !isOpen.send }"
              (click)="toggle('send')"></i>
          </div>
          <div class="item-body" *ngIf="isOpen.send">

            <button (click)="openCreateModal('sendMessage', 'sendText')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Text
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendImage')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Image
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendVideo')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Video
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendDocument')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Document
              <i class="uil-angle-right"></i>
            </button>


          </div>

        </div>

        <div class="sidebar-item pink" (click)="toggle('ask')">
          <div class="item-header">
            <i class="uil uil-question-circle"></i>
            <div>
              <div class="title">Ask Question</div>
              <div class="desc">Ask question and store user input in a variable</div>
            </div>
            <i class="uil" [ngClass]="{ 'uil-angle-down': isOpen.ask, 'uil-angle-right': !isOpen.ask }"></i>
          </div>
          <div class="item-body" *ngIf="isOpen.ask">

            <button (click)="openCreateModal( 'questionOption', 'questionOption')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Question Options
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('openQuestion', 'openQuestion')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Open Question
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('buttonOptions',  'buttonOptions')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Button Options
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('listOptions',  'listOptions')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">List Options
              <i class="uil-angle-right"></i>
            </button>


          </div>
        </div>

        <div class="sidebar-item yellow" (click)="toggle('condition')">
          <div class="item-header">
            <i class="uil uil-check-square"></i>
            <div>
              <div class="title">Set Condition</div>
              <div class="desc">Take action based on logical conditions</div>
            </div>
            <i class="uil" [ngClass]="{ 'uil-angle-down': isOpen.condition, 'uil-angle-right': !isOpen.condition }"></i>
          </div>
          <div class="item-body" *ngIf="isOpen.condition">

            <button (click)="openCreateModal('setConditionsModal', 'askQuestion')" id="draggable-button-1"
              class=" draggable btn btn_des1" draggable="true" class="child-option">Question Options
              <i class="uil-angle-right"></i>
            </button>
          </div>
        </div>

        <div class="sidebar-item blue" (click)="openSidebar('advance')">
          <i class="uil uil-sliders-v"></i> Advance Bot Options
        </div>

        <div class="sidebar-item gray">
          <i class="uil uil-plug"></i> Integrations
        </div>

      </div>

      <div *ngIf="activeSidebar === 'advance'" class="sidebar advance-sidebar">
        <div class="sidebar-header">
          <button (click)="openSidebar('main')" class="btn btn-sm btn-secondary">‚Üê</button>
          <!-- <h4>Advance Bot Options</h4> -->
        </div>

        <div *ngFor="let action of actions" class="action-item"
          (click)="openCreateModal('Advance_Action',action.modal)">
          <div class="icon">
            <!-- <img [src]="action.icon" alt="{{ action.label }} icon" /> -->
            <i [class]="action.icon" [style.color]="action.color" class="iconstyle"></i>
          </div>
          <div class="label">{{ action.label }}</div>
        </div>
      </div>
      <!-- Optional lock/plus controls -->

    </div>

    <div class="new_chat_content">


      <!-- Header for Canvas Section -->
      <div class="canvas-header">
        <div class="canvas-header-left">
          <!-- <button class="back-btn"><span>&larr;</span></button>
    <h3 class="canvas-title">Help & Support</h3> -->
        </div>
        <div class="canvas-header-right">
          <button class="btn save-btn" (click)="saveChatbot()">Save Bot</button>
          <button class="btn publish-btn">Publish</button>
          <button class="close-btn" [routerLink]="['/bot-builder']">&times;</button>
        </div>
      </div>

      <div class="chatbot-canvas" id="drawflow" style="transform: translate(0px, 1px) scale(1);" (drop)="drop($event)"
        (dragover)="allowDrop($event)">
      </div>
    </div>


    <!-- Header for Canvas Section -->


    <div class="new_chat_right">
    </div>
  </div>

  <div class="chatbot_button">
    <div class="bar-zoom">
      <i class="uil uil-plus" (click)="zoomEditor('zoom_in')"></i>
      <i class="uil uil-minus" (click)="zoomEditor('zoom_out')"></i>
      <i class="uil uil-expand-arrows-alt" (click)="zoomEditor('zoom_reset')"></i>
    </div>
    <div class="btn-lock">
      <i *ngIf="showLock" class="uil uil-lock-open-alt" (click)="changeMode('unlock')"></i>
      <i *ngIf="showLock == false" class="uil uil-padlock" (click)="changeMode('lock')"></i>
    </div>
  </div>





</div>













<div class="modal fade" id="sendMessage" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" role="document">
    <div class="modal-content p-4" style="background-color: #FFF6F4; border-radius: 20px;">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="fw-bold m-0" style="color: #6B46C1;">
          {{
          cardType === 'sendText' ? 'Send Text' :
          cardType === 'sendImage' ? 'Send Image' :
          cardType === 'sendVideo' ? 'Send Video' :
          'Send Document'
          }}
        </h6>
      </div>

      <form [formGroup]="sendTextForm" (ngSubmit)="onSubmit()">

        <!-- File Upload -->
        <div *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'"
          class="mb-3 text-center">
          <div class="upload-box d-flex flex-column align-items-center justify-content-center mb-3"
            style="background-color: white; border-radius: 16px; height: 140px; border: 1px dashed #ccc; cursor: pointer;"
            (click)="fileInput.click()">
            <ng-container *ngIf="!selectedImageUrl; else preview">
              <i class="fa fa-plus text-primary"></i>
              <label>
                {{
                cardType === 'sendImage' ? 'Upload Image' :
                cardType === 'sendVideo' ? 'Upload Video' :
                'Upload Document'
                }}
              </label>
            </ng-container>

            <ng-template #preview>
              <img *ngIf="selectedFileType === 'image' || selectedFileType === 'document'" [src]="selectedImageUrl"
                alt="Preview" class="preview-img" style="max-height: 120px;" />
              <video *ngIf="selectedFileType === 'video'" [src]="selectedImageUrl" controls
                style="max-height: 140px; width: 100%; border-radius: 8px;"></video>
            </ng-template>

            <input type="file" [accept]="getFileAccept()" hidden (change)="onFileSelectedData($event)" #fileInput />

            <div *ngIf="sendTextForm.get('file')?.touched && sendTextForm.get('file')?.errors?.['required']"
              style="color: red; font-size: 12px;">
              {{
              cardType === 'sendImage' ? 'Image' :
              cardType === 'sendVideo' ? 'Video' :
              'Document'
              }} is required.
            </div>
          </div>
        </div>


        <!-- Rich Text Editor -->
        <div class="form-group">
          <label *ngIf="cardType == 'sendText'" style="margin-top: 5px; position: absolute;">Text
            Message</label>
          <span *ngIf="cardType == 'sendText'" style="font-size: 13px; color: #6B7280; margin-left: 269px;">
            Characters
          </span>
          <label *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'"
            style="margin-top: 5px; position: absolute;">Text
            Message (Optional) </label>
          <span *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'"
            style="font-size: 13px; color: #6B7280; margin-left: 269px;">
            Characters
          </span>

          <ejs-richtexteditor id="defaultRTE" #chatEditor [toolbarSettings]="tools" [width]="'100%'"
            placeholder="Type Message..." (keyup)="onTextChange()" [pasteCleanupSettings]="pasteCleanupSettings"
            [maxLength]="cardType === 'sendText' ? 4096 : 1024" [showCharCount]='true'
            formControlName="textMessage"></ejs-richtexteditor>


          <div *ngIf="sendTextForm.get('textMessage')?.touched && sendTextForm.get('textMessage')?.errors?.['required']"
            style="color: red; font-size: 12px;">
            Text is required.
          </div>
        </div>

        <!-- Footer Buttons -->
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
          <button class="btn btn-primary"
            style="background-color: #6B46C1; border: none;margin-left: 11px;">Save</button>
        </div>

      </form>
    </div>
  </div>
</div>







<div class="modal fade" id="questionOption" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4 scroller" style="background-color: #FFF6F4; border-radius: 20px;">


      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="fw-bold m-0" style="color: #6B46C1;">Question Option</h6>

        <!-- <button type="button" class="btn-close" aria-label="Close"></button> -->
      </div>
      <div class="modal-body" style="padding: 16px 24px;">
        <form [formGroup]="questionOption" (ngSubmit)="onSubmit('questionOption')">
          <!-- Question Text -->
          <div class="form-group ">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -25px;">Question
              Text</label>
            <span style="font-size: 13px; color: #6B7280; margin-left: 316px;">
              Characters
            </span>

            <!-- </div> -->
            <ejs-richtexteditor id='questionRTE' #questionEditor [toolbarSettings]='tools' [width]="'100%'"
              placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
              formControlName="questionText" style="" [maxLength]='1024' [showCharCount]='true'>
            </ejs-richtexteditor>
          </div>

          <!-- Answer Options Section -->
          <div class="mb-4">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 12px; display: block;">
              Add Answer Option
            </label>

            <div formArrayName="options" class="" style="background-color: #FEF3F7; ">

              <div *ngFor="let option of options?.controls; let i = index" class="mb-3">
                <div class="d-flex align-items-center justify-content-between" style="gap: 8px; flex-wrap: wrap;">
                  <div style="position: relative; flex-grow: 1; width: 100%;">
                    <span style="position: absolute; top: -18px; right: 10px;
                   font-size: 12px; color: #6B7280; z-index: 1;">
                      {{ option.value?.length || 0 }}/20 Character
                    </span>
                    <input type="text" formControlName="{{i}}" class="form-control"
                      [attr.placeholder]="'Option ' + (i + 1)" maxlength="20" style="border: 1px solid #E5E7EB;
               border-radius: 12px;
               padding: 10px 14px;
               font-size: 14px;
               background-color: #fff;
               width: 100%;">

                    <!-- Character Count on the right -->

                  </div>

                  <!-- Remove Button -->
                  <div *ngIf="options?.controls.length > 1" class="mt-1">
                    <button type="button" class="btn btn-link p-0 text-danger removeButton"
                      (click)="removeOption(options,i)">
                      - Remove
                    </button>
                  </div>
                </div>

              </div>

              <!-- Add Option Button -->
              <button type="button" class="btn btn-link text-primary p-0"
                style="font-size: 12px;color: #6B46C1 !important;text-align: right;text-decoration: none;"
                (click)="addOption(options)">
                + Add
              </button>
            </div>

            <div *ngIf="newOptionError" class="text-danger small mt-1">{{ newOptionError }}</div>
          </div>

          <!-- Save answer in Variable -->
          <!-- <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
              Save answer in Variable
            </label>
            <input type="text" class="form-control mb-2"
              style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
              placeholder="@ Enter value" formControlName="saveAnswerVariable">
          </div> -->



                    <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event,questionOption)">
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151;">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="questionOption.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter variable name">
                <div *ngIf="questionOption.get('variableName')?.invalid && questionOption.get('variableName')?.touched"
                  class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be unique
                </div>
              </div>

              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Validation Section -->
          <!-- Validation Settings Section -->
          <div class="mb-3">

            <div class="d-flex justify-content-between align-items-center mb-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500;">Additional Validation Settings</label>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(questionOption)">
                <span class="slider round"></span>
              </label>
            </div>

            <div *ngIf="questionOption.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #F9FAFB;">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event,questionOption)">
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151;">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="questionOption.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter number of reattempts">
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Validation Error Message <span *ngIf="questionOption.get('reattemptsAllowed')?.value"
                    class="text-danger">*</span>
                </label>

                <span style="font-size: 13px; color: #6B7280; margin-left: 282px;">
                  Characters
                </span>

                <ejs-richtexteditor id='questionRTE' #errorEditor [toolbarSettings]='tools' [width]="'100%'"
                  placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
                  formControlName="errorMessage" style="" [maxLength]='1024' [showCharCount]='true'>
                </ejs-richtexteditor>
                <!-- <div class="text-end" style="font-size: 12px; color: #6B7280;">
                  {{ errorMessageLength }}/1024 characters
                </div> -->
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151;">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151;">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end" formControlName="invalidAction">
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151;">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event,questionOption)">
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151;">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="questionOption.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Set reply wait time in minutes">

  
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary"
              style="background-color: #6B46C1; border: none; margin-left: 11px;">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="openQuestion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4 scroller" style="background-color: #FFF6F4; border-radius: 20px;">

      <!-- Header -->
      <div class="modal-header" style="border-bottom: none; padding: 20px 24px 0;">
        <h5 class="modal-title fw-semibold" style="color: #6B46C1;">Open Question</h5>
        <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          style="font-size: 12px;"></button> -->
      </div>

      <div class="modal-body" style="padding: 16px 24px;">
        <form [formGroup]="openQuestion" (ngSubmit)="onSubmit('openQuestion')">
          <!-- Question Text -->
          <div class="form-group">
            <div class="">
              <label style="font-size: 14px; color: #374151; font-weight: 500;margin-bottom: -25px;">Question
                Text</label>
              <!-- <span style="font-size: 12px; color: #6B7280;">{{ questionTextLength }}/1024 characters</span> -->
              <span style="font-size: 13px; color: #6B7280; margin-left: 316px;">
                Characters
              </span>
            </div>
            <ejs-richtexteditor id='questionRTE' #questionEditor [toolbarSettings]='tools' [width]="'100%'"
              placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
              formControlName="questionText" (change)="updateQuestionTextLength(questionEditor)" style=""
              [maxLength]='1024' [showCharCount]='true'>
            </ejs-richtexteditor>
          </div>

          <!-- Save Answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event,openQuestion)">
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151;">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="openQuestion.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter variable name">
                <div *ngIf="openQuestion.get('variableName')?.invalid && openQuestion.get('variableName')?.touched"
                  class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be unique
                </div>
              </div>

              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500;">Additional Validation Settings</label>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(openQuestion)">
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="openQuestion.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #F9FAFB;">
              <!-- Answer Type Selection -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Select Answer Type
                </label>
                <select class="form-select" class="form-control" formControlName="answerType"
                  (change)="onAnswerTypeChange()"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 6px 4px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="email">Email</option>
                  <option value="date">Date</option>
                  <option value="custom">Custom</option>
                </select>
              </div>

              <!-- Validation Fields Based on Answer Type -->
              <div *ngIf="openQuestion.get('answerType')?.value === 'text'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Minimum characters
                    </label>
                    <input type="number" min="0" class="form-control" formControlName="minChars"
                      style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  </div>
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Maximum characters
                    </label>
                    <input type="number" min="1" class="form-control" formControlName="maxChars"
                      style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  </div>
                </div>
                <div class="mb-2">
                  <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                    Regular Expression
                  </label>
                  <input type="text" class="form-control" formControlName="textRegex"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter regex pattern">
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'number'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Minimum number
                    </label>
                    <input type="number" class="form-control" formControlName="minNumber"
                      style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  </div>
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Maximum number
                    </label>
                    <input type="number" class="form-control" formControlName="maxNumber"
                      style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  </div>
                </div>
                <div class="mb-2">
                  <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                    Regular Expression
                  </label>
                  <input type="text" class="form-control" formControlName="numberRegex"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter regex pattern">
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'date'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Minimum date
                    </label>
                    <input type='date' formControlName="minDate" format="dd/MM/yyyy" placeholder="Select date"
                      style="width: 100%; border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">

                  </div>
                  <div class="col-md-6 mb-2">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                      Maximum date
                    </label>
                    <input type='date' formControlName="maxDate" format="dd/MM/yyyy" placeholder="Select date"
                      style="width: 100%; border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  </div>
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'custom'" class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Regular Expression
                </label>
                <input type="text" class="form-control" formControlName="customRegex"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter regex pattern">
              </div>

              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event,openQuestion)">
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151;">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="openQuestion.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter number of reattempts">
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Validation Error Message <span *ngIf="openQuestion.get('reattemptsAllowed')?.value"
                    class="text-danger">*</span>
                </label>
                <span style="font-size: 13px; color: #6B7280; margin-left: 282px;">
                  Characters
                </span>
                <ejs-richtexteditor id='errorRTE' #errorEditor [toolbarSettings]='basicTools' [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]='1024'
                  [showCharCount]='true' (change)="updateErrorMessageLength(errorEditor)" style="">
                </ejs-richtexteditor>

              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151;">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151;">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end" formControlName="invalidAction">
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151;">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event,openQuestion)">
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151;">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="openQuestion.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Set reply wait time in minutes">

                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>




          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary"
              style="background-color: #6B46C1; border: none; margin-left: 11px;">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>










<!-- Ask Buttons Modal -->
<div class="modal fade" id="buttonOptions" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 33%;">
    <div class="modal-content p-4 scroller" style="background-color: #FFF6F4; border-radius: 20px;">

      <!-- Header -->
      <div class="modal-header" style="border-bottom: none; padding: 20px 24px 0;">
        <h5 class="modal-title fw-semibold" style="color: #6B46C1;">Button Options</h5>
      </div>

      <div class="modal-body" style="padding: 16px 24px;">
        <form [formGroup]="buttonOptions" (ngSubmit)="onSubmit('buttonOptions')">
          <!-- Header Options -->
          <div class="mb-3">

            <div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'none'">
                <input type="radio" name="headerType" value="none" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions,'none')"> none
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'text'">
                <input type="radio" name="headerType" value="text" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions,'text')"> Text
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'image'">
                <input type="radio" name="headerType" value="image" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions,'image')"> Image
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'video'">
                <input type="radio" name="headerType" value="video" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions,'video')"> Video
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'document'">
                <input type="radio" name="headerType" value="document" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions,'document')"> Document
              </label>
            </div>

            <label *ngIf="buttonOptions.get('headerType')?.value != 'none'"
              style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -30px; display: block;">
              Header (Optional)
            </label>

            <!-- Header Content Based on Selection -->
            <div *ngIf="buttonOptions.get('headerType')?.value === 'text'" class="mt-3">
              <div class="d-flex justify-content-end align-items-center mb-1">
                <span style="font-size: 12px; color: #6B7280;">{{ (buttonOptions.get('headerText')?.value?.length) ||
                  0}}/60 Characters</span>
              </div>
              <input type="text" class="form-control" formControlName="headerText"
                (input)="updateHeaderTextLength(buttonOptions)"
                style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                maxlength="60" placeholder="Enter header text">
            </div>

            <div *ngIf="['image','video','document'].includes(buttonOptions.get('headerType')?.value)" class="mt-3">

              <div class="d-flex justify-content-center align-items-center flex-column py-4"
                style="border: 1px dashed #D1D5DB; border-radius: 12px; background-color: #fff; text-align: center;">

                <!-- Upload Button (shown when no file selected) -->
                <label for="mediaUpload" class="mb-2" style="cursor: pointer;" *ngIf="!selectedFileUrl">
                  <div
                    style="width: 48px; height: 48px; border-radius: 50%; background-color: #7C3AED; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #fff; font-size: 24px;">+</span>
                  </div>
                </label>

                <!-- File Input (hidden) -->
                <input id="mediaUpload" type="file" class="d-none" (change)="onFileSelected($event)"
                  [accept]="getFileAcceptType(buttonOptions.get('headerType')?.value)">

                <!-- Upload Message -->
                <small class="text-muted" *ngIf="!selectedFileUrl">
                  {{ buttonOptions.get('headerType')?.value }}
                </small>

                <!-- IMAGE Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'image'" class="mt-3 text-center">
                  <img [src]="selectedFileUrl" alt="Uploaded Image" class="img-fluid rounded mb-2"
                    style="max-width: 100%; max-height: 150px; object-fit: cover;">
                  <!-- <button type="button" class="btn btn-link p-0 text-danger" (click)="removeFile()">Remove</button> -->
                </div>

                <!-- VIDEO Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'video'" class="mt-3 text-center">
                  <video [src]="selectedFileUrl" controls class="rounded"
                    style="max-width: 100%; max-height: 180px;"></video>
                  <!-- <button type="button" class="btn btn-link p-0 text-danger" (click)="removeFile()">Remove</button> -->
                </div>

                <!-- DOCUMENT Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'document'" class="mt-3 text-center">
                  <div class="d-flex align-items-center justify-content-center">
                    <i class="bi bi-file-earmark-text" style="font-size: 24px; color: #6B7280;"></i>
                    <span class="ms-2">{{ uploadedFile?.name }}</span>

                  </div>
                </div>

                <!-- File Size Note -->
                <div class="mt-2" style="font-size: 12px; color: #6B7280;">
                  Max size: {{ buttonOptions.get('headerType')?.value === 'image' ? '5MB' : '10MB' }}
                </div>
              </div>

              <!-- Optional Link Field -->
            </div>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <button *ngIf="selectedFileUrl" type="button" style="font-size: 12px;text-decoration: none;"
                class="btn btn-link p-0 ms-2 text-danger" (click)="removeFile()">Remove</button>
            </div>






          </div>

          <!-- Body Text -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -13px; display: block;">
              Body Text
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6B7280;margin-right: -5px;"> Characters</span>
            </div>
            <ejs-richtexteditor id='bodyRTE' #bodyEditor [toolbarSettings]='tools' [width]="'100%'"
              placeholder="Enter body text..." [pasteCleanupSettings]="pasteCleanupSettings" formControlName="bodyText"
              (change)="updateBodyTextLength(bodyEditor)" style="" [maxLength]='1024' [showCharCount]='true'>
            </ejs-richtexteditor>
          </div>

          <!-- Footer Text -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -13px; display: block;">
              Footer Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6B7280;">{{(buttonOptions.get('footerText')?.value?.length) ||
                0}}/60 characters</span>
            </div>
            <input type="text" class="form-control" formControlName="footerText"
              (input)="updateFooterTextLength(buttonOptions)" maxlength="60"
              style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
              placeholder="Enter footer text">
          </div>

          <!-- Buttons Section -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 12px; display: block;">
              Buttons
            </label>

            <div formArrayName="buttons" class="" style="background-color: #FEF3F7; ">

              <div *ngFor="let button of buttons?.controls; let i = index" class="mb-3">
                <div class="d-flex justify-content-end align-items-center mb-1" style="gap: 8px; flex-wrap: wrap;">

                  <div style="font-size: 12px; color: #6B7280; min-width: 100px; text-align: right;">
                    {{ button.value?.length || 0 }}/20 Characters
                  </div>
                  <!-- Input field for button label -->
                  <input type="text" [formControlName]="i" class="form-control flex-grow-1"
                    [attr.placeholder]="'Button ' + (i + 1)" style="border: 1px solid #E5E7EB;
                    border-radius: 12px;
                    padding: 10px 14px;
                    font-size: 14px;
                    background-color: #fff;" maxlength="20">

                  <!-- Character count -->


                  <!-- Remove button -->
                  <button *ngIf="buttons?.controls.length > 1" type="button" class="btn btn-link text-danger p-0 ms-2"
                    style="font-size: 12px; text-decoration: none;" (click)="removeButton(buttons,i)">
                    - Remove
                  </button>
                </div>
              </div>

              <!-- Add Button -->
              <button type="button" *ngIf="buttons?.controls.length < 3" class="btn btn-link text-primary p-0"
                style="font-size: 12px;color: #6B46C1 !important;" (click)="addButton(buttons)">
                + Add
              </button>
            </div>


          </div>

          <!-- Save answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event,buttonOptions)">
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151;">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="buttonOptions.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter variable name">
                <div *ngIf="buttonOptions.get('variableName')?.invalid && buttonOptions.get('variableName')?.touched"
                  class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be unique
                </div>
              </div>

              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500;">Additional Validation Settings</label>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(buttonOptions)">
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="buttonOptions.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #F9FAFB;">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event,buttonOptions)">
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151;">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="buttonOptions.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter number of reattempts">
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Validation Error Message <span *ngIf="buttonOptions.get('reattemptsAllowed')?.value"
                    class="text-danger">*</span>
                </label>
                <div class="text-end" style="font-size: 13px; color: #6B7280;margin-left: 297px;">
                  Characters
                </div>
                <ejs-richtexteditor id='errorRTE' #errorEditor [toolbarSettings]='basicTools' [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]='1024'
                  [showCharCount]='true' (change)="updateErrorMessageLength(errorEditor)" style="">
                </ejs-richtexteditor>

              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151;">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151;">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end" formControlName="invalidAction">
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151;">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event,buttonOptions)">
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151;">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="buttonOptions.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Set reply wait time in minutes">

                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type='button' class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" style="background-color: #6B46C1; border: none; margin-left: 11px;"
              [disabled]="!buttonOptions.valid || buttons?.controls.length === 0">Save</button>
          </div>

          <!-- Footer Buttons -->

        </form>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="listOptions" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4 scroller" style="background-color: #FFF6F4; border-radius: 20px;">

      <!-- Header -->
      <div class="modal-header" style="border-bottom: none; padding: 20px 24px 0;">
        <h5 class="modal-title fw-semibold" style="color: #6B46C1;">List Options</h5>
      </div>

      <div class="modal-body" style="padding: 16px 24px;">
        <form [formGroup]="listOptions" (ngSubmit)="onSubmit('listOptions')">
          <!-- Header Text -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -15px; display: block;">
              Header Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6B7280;">{{ (listOptions.get('headerText')?.value?.length) || 0}}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="headerText"
              (input)="updateHeaderTextLength(listOptions)"
              style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
              placeholder="Enter header text">
          </div>

          <!-- Body Text -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -15px; display: block;">
              Body Text
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6B7280;margin-right: -5px;"> Characters</span>
            </div>
            <ejs-richtexteditor id='bodyRTE' #bodyEditor [toolbarSettings]='tools' [width]="'100%'"
              placeholder="Enter body text..." [pasteCleanupSettings]="pasteCleanupSettings" formControlName="bodyText"
              style="" [maxLength]='1024' [showCharCount]='true'>
            </ejs-richtexteditor>
          </div>

          <!-- Footer Text -->
          <div class="mb-3">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -15px; display: block;">
              Footer Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6B7280;"> {{(listOptions.get('footerText')?.value?.length) || 0}}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="footerText"
              (input)="updateFooterTextLength(listOptions)" maxlength="60"
              style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
              placeholder="Enter footer text">
          </div>

          <!-- List Configuration -->
          <div class="mb-3">


            <!-- List Header -->
            <div class="mb-3">
              <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -15px; display: block;">
                List Header
              </label>
              <div class="d-flex justify-content-end align-items-center mb-1">
                <span style="font-size: 12px; color: #6B7280;">{{(listOptions.get('listHeader')?.value?.length) ||
                  0}}/20 characters</span>
              </div>
              <input type="text" class="form-control" formControlName="listHeader"
                (input)="updateListHeaderLength(listOptions)" maxlength="20"
                style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                placeholder="Enter list header">
            </div>

            <!-- Sections -->

            <div formArrayName="sections" *ngIf="listOptionSections">
              <div *ngFor="let section of listOptionSections.controls; let sectionIndex = index" class="mb-4">
                <!-- Add this wrapper -->
                <div [formGroupName]="sectionIndex" class="border p-3 rounded-lg shadow-sm"
                  style="background-color: #FFEAE6;">


                  <!-- Section Heading -->
                  <div class="mb-3">
                    <label
                      style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -17px; display: block;">
                      Section {{sectionIndex + 1}} Header (Optional)
                    </label>

                    <div class="d-flex justify-content-end align-items-center mb-1">
                      <span style="font-size: 12px; color: #6B7280;">{{(section.get('sectionHeading')?.value?.length) ||
                        0}}/20 characters</span>
                    </div>
                    <input type="text" class="form-control" formControlName="sectionHeading" maxlength="20"
                      placeholder="Enter section heading">
                  </div>

                  <!-- Rows -->
                  <div formArrayName="rows" class="space-y-3">
                    <div
                      *ngFor="let row of getSectionRows(listOptionSections, sectionIndex).controls; let rowIndex = index"
                      class="border-b border-gray-200 pb-3">
                      <!-- Add this wrapper -->
                      <div [formGroupName]="rowIndex">




                        <div class="flex justify-between items-center mb-2">
                          <label
                            style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: -17px; display: block;">
                            Option {{rowIndex + 1}}
                          </label>
                        


                        </div>
                           <div class="d-flex justify-content-end align-items-center mb-1">
                      <span style="font-size: 12px; color: #6B7280;">{{(row.get('rowName')?.value?.length) ||
                        0}}/20 characters</span>
                    </div>

                        <!-- Row Name -->
                        <div class="mb-2">
                          <input type="text" class="form-control" formControlName="rowName"  maxlength="20"
                            placeholder="Enter option name">
                        </div>

                        <!-- Row Description -->
                        <div>
                           <div class="d-flex justify-content-end align-items-center mb-1">
                          <span style="font-size: 12px; color: #6B7280;">{{(row.get('rowDescription')?.value?.length) ||
                        0}}/60 characters</span>
                        </div>
                          <textarea class="form-control" formControlName="rowDescription" maxlength="60"
                            placeholder="Enter description"></textarea>
                          <button type="button" class="btn btn-link p-0 text-danger removeButtonbtn"
                            style="font-size: 12px; text-decoration: none;"
                            (click)="removeRow(listOptionSections, sectionIndex, rowIndex)"
                            [disabled]="getSectionRows(listOptionSections, sectionIndex).controls.length <= 1">
                            Remove
                          </button>

                        </div>
                      </div>
                    </div>
                    <button type="button" class="btn btn-link p-0" (click)="addRow(listOptionSections, sectionIndex)"
                      style="font-size: 12px;color: #6B46C1 !important;text-align: right;text-decoration: none;">
                      + Add
                    </button>
                  </div>
                </div>
                <button type="button" class="btn btn-link p-0 text-danger removeSectionbtn"
                  (click)="removeSection(listOptionSections, sectionIndex)"
                  [disabled]="listOptionSections.controls.length <= 1">
                  Remove Section
                </button>
              </div>
            </div>

            <button type="button" class="btn btn-link p-0 "
              style="font-size: 12px; text-decoration: none;color: #6B46C1;" (click)="addSection(listOptionSections)">
              + Add New Section
            </button>


          </div>

          <!-- Save answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event,listOptions)">
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151;">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="listOptions.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter variable name">
                <div *ngIf="listOptions.get('variableName')?.invalid && listOptions.get('variableName')?.touched"
                  class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be unique
                </div>
              </div>

              <div class="mb-2">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType"
                  style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500;">Additional Validation Settings</label>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(listOptions)">
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="listOptions.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #F9FAFB;">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event,listOptions)">
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151;">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="listOptions.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter number of reattempts">
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Validation Error Message <span *ngIf="listOptions.get('reattemptsAllowed')?.value"
                    class="text-danger">*</span>
                </label>
                 <div class="text-end" style="font-size: 13px; color: #6B7280;margin-left: 285px;">
                  Characters
                </div>
                <ejs-richtexteditor id='errorRTE' #errorEditor [toolbarSettings]='basicTools' [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]='1024'
                  [showCharCount]='true' 
                  style="" >
                </ejs-richtexteditor>
                <div class="text-end" style="font-size: 12px; color: #6B7280;">
                  {{ errorMessageLength }}/1024 characters
                </div>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 8px; display: block;">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151;">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction">
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151;">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end" formControlName="invalidAction">
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151;">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event,listOptions)">
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151;">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="listOptions.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes"
                    style="border: 1px solid #E5E7EB; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Set reply wait time in minutes">

 
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction">
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151;">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>



          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" style="background-color: #6B46C1; border: none; margin-left: 11px;"
              [disabled]="!listOptions.valid || getTotalRowCount(listOptionSections) === 0">Save</button>
          </div>





          <!-- Footer Buttons -->

        </form>
      </div>
    </div>
  </div>
</div>








<div class="modal fade" id="setConditionsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4" style="background-color: #FFF6F4; border-radius: 20px;">

      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h5 class="modal-title" style="color: #6B46C1;">Set Conditions</h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body scrolles">

        <form [formGroup]="conditionForm" (ngSubmit)="saveConditions()">

          <div formArrayName="conditions">
            <div *ngFor="let condition of conditionsArray.controls; let i = index" [formGroupName]="i"
              class="condition-group">

              <!-- Comparator -->
              <label class="form-label">Select a Comparator</label>
              <div class="input-group mb-3">
                <div class="custom-input-wrapper">
                  <input type="text" class="custom-input" formControlName="comparator"
                    placeholder="Enter variable or attribute" (focus)="isFocused = true" (blur)="isFocused = false"
                    (input)="onComparatorChange(i)" />
                  <span class="toggle_attribute" (click)="openAttributeOption(i, 'comparator')"></span>
                  <button type="button" class="custom-button" [class.focused]="isFocused"
                    (click)="toggleVarMenu(i, 'comparator')">
                    Bot Var
                  </button>
                </div>

                <!-- Attribute Menu -->
                <div class="bot-var-menu"
                  [class.visible]="showAttribute?.index === i && showAttribute?.field === 'comparator'">
                  <div *ngFor="let variable of attributeList" class="bot-var-item"
                    (click)="selectVariable(i, 'comparator', variable)">
                    <i class="fas fa-tag me-2"></i> {{ variable.label }}
                  </div>
                </div>

                <!-- Bot Variable Menu -->
                <div class="bot-var-menu"
                  [class.visible]="showVarMenuFor?.index === i && showVarMenuFor?.field === 'comparator'">
                  <div *ngFor="let variable of sampleVariables" class="bot-var-item"
                    (click)="selectVariable(i, 'comparator', variable)">
                    <i class="fas fa-tag me-2"></i> {{ variable.label }}
                  </div>
                </div>
              </div>

              <!-- Operator -->
              <label class="form-label">Operator</label>
              <select class="form-select mb-3" formControlName="operator">
                <option value="" disabled>Select operator</option>
                <option *ngFor="let op of getOperators(getConditionGroup(i).get('comparatorType')?.value)" [value]="op">
                  {{ op }}
                </option>
              </select>

              <!-- Value -->
              <label class="form-label">Select a Value</label>
              <div class="input-group mb-3">
                <div class="custom-input-wrapper">
                  <input type="text" class="custom-input" formControlName="value" placeholder="Enter value"
                    (focus)="isFocused = true" (blur)="isFocused = false" />
                  <span class="toggle_attribute" (click)="openAttributeOption(i, 'value')"></span>
                  <button type="button" class="custom-button" [class.focused]="isFocused"
                    (click)="toggleVarMenu(i, 'value')">
                    Bot Var
                  </button>
                </div>

                <!-- Value Var Menu -->
                <div class="bot-var-menu"
                  [class.visible]="showVarMenuFor?.index === i && showVarMenuFor?.field === 'value'">
                  <div *ngFor="let variable of sampleVariables" class="bot-var-item"
                    (click)="selectVariable(i, 'value', variable)">
                    <i class="fas fa-tag me-2"></i> {{ variable.label }}
                  </div>
                </div>
              </div>

              <!-- Actions -->
              <div class="action-links mt-3">
                <a (click)="addCondition()">+ Add Condition</a>
                <a *ngIf="conditionsArray.length > 1" class="remove" (click)="removeCondition(i)">- Remove</a>
              </div>

              <!-- AND / OR Toggle -->
              <div *ngIf="i < conditionsArray.length - 1" class="toggle-wrapper mt-3">
                <button type="button" class="toggle"
                  [class.active]="getConditionGroup(i).get('nextJoinType')?.value === 'AND'"
                  (click)="getConditionGroup(i).get('nextJoinType')?.setValue('AND')">And</button>
                <button type="button" class="toggle"
                  [class.active]="getConditionGroup(i).get('nextJoinType')?.value === 'OR'"
                  (click)="getConditionGroup(i).get('nextJoinType')?.setValue('OR')">Or</button>
              </div>

              <hr *ngIf="i < conditionsArray.length - 1" />
            </div>
          </div>

          <!-- Save / Cancel -->
          <div class="d-flex justify-content-end gap-2 mt-4">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary" style="background-color: #6B46C1; border: none;"
              [disabled]="!conditionForm.valid">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="assignAgentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h5 class="modal-title" style="color: #6B46C1;">Assign Conversation to Agent</h5>
      </div>

      <div class="modal-body scrolles ">
        <div class="condition-group">
          <div class="search-container mb-3">
            <!-- <i class="fas fa-search search-icon"></i> -->
            <input type="text" class="form-control search-box " placeholder="Search" [(ngModel)]="searchQuery"
              (input)="filterAgents()">
          </div>

          <div class="agent-list">
            <div *ngFor="let agent of filteredAgents" class="agent-item"
              [class.active]="selectedAgentDetails?.id === agent?.id" (click)="selectAgent(agent)">
              <div class="agent-avatar">{{ getInitials(agent.name) }}</div>
              <div class="agent-name">{{ agent.name }}</div>
            </div>

            <div *ngIf="filteredAgents.length === 0" class="no-results">
              No agents found
            </div>
          </div>
        </div>

      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" [disabled]="!selectedAgentDetails"
          (click)="onSubmit('assignAgentModal')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>







<div class="modal fade" id="assigntoContactOwner" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Assign conversation to contact owner</h6>
      </div>

      <div class="modal-body scrolles ">
        <div class="condition-groupchat">
          <span>Conversation Assign to contact owner</span>
        </div>

      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit('assigntoContactOwner')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="UnassignConversation" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Unassign conversation</h6>
      </div>

      <div class="modal-body scrolles ">
        <div class="condition-groupchat">
          <span>conversation will be moved to the Unassigned Tab</span>
        </div>

      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit('UnassignConversation')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="UpdateConversationStatus" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Update Conversation Status</h6>
      </div>

      <div class="modal-body scrolles ">
        <div class="condition-groupchat">
          <span>To Update status select a value</span>

          <div class="row">
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px;">
              <input type="radio" class="form-check-input" id="resolved" name="status" value="Resolved"
                [(ngModel)]="conversationActions.status" style="margin-top: 16px" />
              <label class="form-check-label" for="resolved">Resolved</label>
            </div>
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px;">
              <input type="radio" class="form-check-input" id="open" name="status" value="Open" style="margin-top: 16px"
                [(ngModel)]="conversationActions.status" />
              <label class="form-check-label" for="open">Open</label>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('UpdateConversationStatus')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>






<div class="modal fade" id="UpdateContactAttribute" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Update Contact Attribute</h6>
      </div>

      <form [formGroup]="contactAttributeForm" (ngSubmit)="onSubmit('UpdateContactAttribute')">
        <div class="modal-body scrolles">
          <!-- Select Attribute Section -->
          <div class="mb-4">
            <h6>Select Attribute</h6>
            <select class="form-select" formControlName="selectedAttribute" (change)="onAttributeChange($event)">
              <option value="null" disabled selected>Select an attribute</option>
              <option *ngFor="let attr of availableAttributes" [value]="attr.name">{{attr.label}}</option>
            </select>
          </div>

          <!-- Value Input Section -->
          <div class="mb-4" *ngIf="contactAttributeForm.get('selectedAttribute')?.value">
            <h6>Value</h6>
            <div class="custom-input-wrapper">
              <input type="text" class="custom-input" formControlName="selectedValue"
                placeholder="Enter variable or attribute" (focus)="isFocused = true" (blur)="isFocused = false" />
              <span class="toggle_attributes" (click)="selectAttribute('attr')"></span>
              <button type="button" class="custom-button" [class.focused]="isFocused"
                (click)="selectAttribute('Botvar')">
                Bot Var
              </button>


              <!-- Attribute Menu -->
              <div class="bot-var-menu" [class.visible]="openDropdown.status === 'attr'">
                <div *ngFor="let variable of attributeList" class="bot-var-item" (click)="selectedValues(variable)">
                  <i class="fas fa-tag me-2"></i> {{ variable.label }}
                </div>
              </div>
              <div class="bot-var-menu" [class.visible]="openDropdown.status === 'Botvar'">
                <div *ngFor="let variable of sampleVariables" class="bot-var-item" (click)="selectedValues(variable)">
                  <i class="fas fa-tag me-2"></i> {{ variable.label }}
                </div>
              </div>
            </div>

          </div>

          <!-- Operation Section -->
          <div class="mb-4" *ngIf="contactAttributeForm.get('selectedAttribute')?.value">
            <h6>Operation</h6>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="replace" formControlName="operation" value="replace">
              <label class="form-check-label" for="replace">Replace</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="addIfEmpty" formControlName="operation"
                value="addIfEmpty">
              <label class="form-check-label" for="addIfEmpty">Add If Empty</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="append" formControlName="operation" value="append">
              <label class="form-check-label" for="append">Append</label>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!contactAttributeForm.valid">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- tag-selection-modal.component.html -->
<!-- tag-selection-modal.component.html -->
<div class="modal fade" id="AddTags" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Add Tags</h6>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>Select one or more tags to apply</span>

          <!-- Search input -->
          <div class="form-group mt-3 mb-3">
            <input type="text" class="form-control" placeholder="Search tags..." [(ngModel)]="searchTerm"
              (input)="filterTags()">
          </div>

          <!-- Tag list with checkboxes and colored labels -->
          <div class="tag-list scrolles">
            <div class="form-check mt-2" *ngFor="let tag of filteredTags">
              <input type="checkbox" class="form-check-input" [id]="'tag-' + tag.value"
                [checked]="isTagSelected(tag.value)" (change)="toggleTagSelection(tag.value)"
                style="margin-top: 16px" />
              <label class="form-check-label" [for]="'tag-' + tag.value">
                <span class="tag-dot" [ngClass]="'dot-' + tag.style"></span>
                <span class="tag-text" [class.font-weight-bold]="tag.value === 'Paid' || tag.value === 'Return'">
                  {{ tag.label }}
                </span>
              </label>
            </div>
          </div>
        </div>

        <div class="operation-options">
          <div class="form-check">
            <label class="form-check-label" style="margin-left: -26px;
    font-size: 15px;
    font-weight: bold">Opration</label>
            <input type="checkbox" class="form-check-input" id="addIfEmpty" style="margin-top: 14px"
              [(ngModel)]="operationOptions.addIfEmpty">
            <label class="form-check-label" for="addIfEmpty">Add If Empty</label>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light me-2" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('AddTags')">Save</button>

        </div>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="RemoveTag" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Remove Tags</h6>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>Select one or more tags to apply</span>

          <!-- Search input -->
          <div class="form-group mt-3 mb-3">
            <input type="text" class="form-control" placeholder="Search tags..." [(ngModel)]="searchTerm"
              (input)="filterTags()">
          </div>

          <!-- Tag list with checkboxes and colored labels -->
          <div class="tag-list scrolles">
            <div class="form-check mt-2" *ngFor="let tag of filteredTags">
              <input type="checkbox" class="form-check-input" [id]="'tag-' + tag.value"
                [checked]="isTagSelected(tag.value)" (change)="toggleTagSelection(tag.value)"
                style="margin-top: 16px" />
              <label class="form-check-label" [for]="'tag-' + tag.value">
                <span class="tag-dot" [ngClass]="'dot-' + tag.style"></span>
                <span class="tag-text" [class.font-weight-bold]="tag.value === 'Paid' || tag.value === 'Return'">
                  {{ tag.label }}
                </span>
              </label>
            </div>
          </div>
        </div>

        <div class="operation-options">
          <div class="form-check">
            <label class="form-check-label" style="margin-left: -26px;
    font-size: 15px;
    font-weight: bold">Opration</label>
            <input type="checkbox" class="form-check-input" id="addIfEmpty" style="margin-top: 14px"
              [(ngModel)]="operationOptions.addIfEmpty">
            <label class="form-check-label" for="addIfEmpty">Add If Empty</label>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light me-2" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('RemoveTag')">Save</button>

        </div>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="MessageOptin" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Message Opt-in</h6>
      </div>

      <div class="modal-body scrolles ">
        <div class="condition-groupchat">
          <span>To Update Message Opt-in select a value</span>

          <div class="row">
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px;">
              <input type="radio" class="form-check-input" id="Yes" name="Yes" value="Yes"
                [(ngModel)]="conversationActions.status" style="margin-top: 16px" />
              <label class="form-check-label" for="Yes">Yes</label>
            </div>
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px;">
              <input type="radio" class="form-check-input" id="No" name="status" value="No" style="margin-top: 16px"
                [(ngModel)]="conversationActions.status" />
              <label class="form-check-label" for="No">No</label>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('MessageOptin')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- time-delay-modal.component.html -->
<div class="modal fade" id="TimeDelayModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Add Time Delay</h6>
      </div>

      <div class="modal-body">
        <div class="time-delay-controls">
          <div class="row align-items-center">
            <div class="col-4">
              <label class="form-label">Time</label>
              <input type="number" class="form-control" style="width: 80px;" [min]="1"
                [max]="delayUnit === 'hour' ? 24 : 60" (change)="validateTime()" [(ngModel)]="delayTime" min="1"
                placeholder="10">
            </div>
            <div class="col-4">
              <label class="form-label">Minute/Hour</label>
              <select class="form-select" style="width: 120px;" [(ngModel)]="delayUnit" (change)="onUnitChange()">
                <option value="minute">Minute</option>
                <option value="hour">Hour</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0 mt-4">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('TimeDelayModal')">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>



<!-- bot-trigger-modal.component.html -->
<div class="modal fade" id="BotTriggerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 400px;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;">Bot Trigger</h6>
      </div>

      <div class="modal-body">
        <div class="mb-3">
          <p class="text-muted small">This node will trigger another bot and terminate the current Bot</p>
        </div>

        <div class="form-group mb-4">
          <label class="form-label">Select Bot to Trigger</label>
          <select class="form-select" [(ngModel)]="selectedBotId" (ngModelChange)="getSelectedBot($event)">
            <option value="" disabled selected>Select a bot</option>
            <option *ngFor="let bot of availableBots" [value]="bot.id" [disabled]="!bot.published">
              {{ bot.name }} {{ !bot.published ? '(Unpublished)' : '' }}
            </option>
          </select>


        </div>

      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" [disabled]="!selectedBotId" (click)="onSubmit('BotTriggerModal')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="NotificationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6B46C1;"> Notify</h6>
      </div>


      <div class="modal-body scrolles">

        <form [formGroup]="notificationForm">
          <!-- Select Agents -->

          <div class="form-group mb-4">
            <label class="form-label">Select Agent</label>
            <select class="form-control" formControlName="selectedAgentIds" style="padding: 0px 17px;"
              (change)="onAgentChange($event)">
              <option value="" disabled selected>
                Select Agent
              </option>
              <option *ngFor="let agent of availableAgents" [value]="agent.id">
                {{ agent.name }} ({{ agent.status | titlecase }})
              </option>
            </select>
          </div>
          <!-- Message -->
          <div class="form-group mb-3">
            <label class="form-label">Notification Message</label>
             <div class="text-end" style="font-size: 13px; color: #6B7280;margin-left: 307px;">
                  Characters
                </div>
            <ejs-richtexteditor id="defaultRTE" #chatEditor [toolbarSettings]="tools" [width]="'90%'" [maxLength]='1024'
                  [showCharCount]='true' 
              placeholder="Type Message..." [pasteCleanupSettings]="pasteCleanupSettings" formControlName="textMessage">
            </ejs-richtexteditor>

          </div>
        </form>


        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('NotificationModal')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

</div>