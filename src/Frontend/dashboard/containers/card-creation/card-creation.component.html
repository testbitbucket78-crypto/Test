
<sb-top-nav title="Bot Builder"></sb-top-nav>
<sb-loader [isLoading]="isLoading"></sb-loader>


 <div class="toaster" (click)="hideToaster()">
        <p *ngIf="errorMessage" class="error">{{ errorMessage }}</p>
        <p *ngIf="successMessage" class="success">{{ successMessage }}</p>
        <p *ngIf="warningMessage" class="warn">{{ warningMessage }}</p>
    </div>


<div class="new_chat_boat_1 conten_set">

  <div class="new_chat_boat_2">
    <div class="canvas-toggle" (click)="toggleSidebar()">
      <i class="uil" [ngClass]="isSidebarCollapsed ? 'uil-angle-right' : 'uil-angle-left'"></i>
    </div>
    <div class="new_chat_left" [class.collapsed]="isSidebarCollapsed">



      <div class="sidebar" *ngIf="activeSidebar === 'main'">

        <div class="sidebar-item purple">
          <div class="item-header" (click)="toggle('send')">
             <img src="assets/img/send-msg.svg">
             
            <div>
              <div class="title">Send Message</div>
              <div class="desc">No response expected from the user</div>
            </div>
            <i class="uil" [ngClass]="{
                                'uil-angle-down': isOpen.send,
                                'uil-angle-right': !isOpen.send
                            }" ></i>
          </div>
          <div class="item-body" *ngIf="isOpen.send" [class.disabled]="viewMode">
            <button (click)="openCreateModal('sendMessage', 'sendText')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Text
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendImage')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Image
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendVideo')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Video
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('sendMessage', 'sendDocument')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Document
              <i class="uil-angle-right"></i>
            </button>
          </div>
        </div>

        <div class="sidebar-item pink" (click)="toggle('ask')" >
          <div class="item-header">
            <img src="assets/img/ask-q.svg">
            <div>
              <div class="title">Ask Question</div>
              <div class="desc">Ask question and store user input in a variable</div>
            </div>
            <i class="uil" [ngClass]="{
                                'uil-angle-down': isOpen.ask,
                                'uil-angle-right': !isOpen.ask
                            }"></i>
          </div>
          <div class="item-body" *ngIf="isOpen.ask" [class.disabled]="viewMode">
            <button (click)="openCreateModal('questionOption', 'questionOption')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Question Options
              <i class="uil-angle-right"></i>
            </button>
            <button (click)="openCreateModal('openQuestion', 'openQuestion')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Open Question
              <i class="uil-angle-right"></i>
            </button>
            <button *ngIf="!(ChannelWhatsAppOrWebSelection == 'webJS' && channelName == 'web')" (click)="openCreateModal('buttonOptions', 'buttonOptions')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              Button Options
              <i class="uil-angle-right"></i>
            </button>
            <button *ngIf="!(ChannelWhatsAppOrWebSelection == 'webJS' && channelName == 'web')" (click)="openCreateModal('listOptions', 'listOptions')" id="draggable-button-1"
              class="draggable btn btn_des1" draggable="true" class="child-option">
              List Options
              <i class="uil-angle-right"></i>
            </button>
            <button *ngIf="channelName == 'api'" (click)="openCreateModal('whatsAppFlow', 'whatsAppFlow')"
              id="draggable-button-1" class="draggable btn btn_des1" draggable="true" class="child-option">
              WhatsApp Flow
              <i class="uil-angle-right"></i>
            </button>
          </div>
        </div>

        <div class="sidebar-item yellow" (click)="toggle('condition')" >
          <div class="item-header" (click)="openCreateModal('setConditionsModal', 'setCondition')" [class.disabled]="viewMode">
             <img src="assets/img/set-condition.svg" style="height: 30px;width: 28px;">
            <div>
              <div class="title">Set Condition</div>
              <div class="desc">Take action based on logical conditions</div>
            </div>
                     <i class="uil" [ngClass]="{
                                'uil-angle-down': isOpen.ask,
                                'uil-angle-right': !isOpen.ask
                            }"></i>
          </div>
        </div>

        <div class="sidebar-item blue" (click)="openSidebar('advance')" >
          <div class="item-header" >
          <!-- <i class="uil uil-sliders-v"></i>  -->
           <div>
              <div class="title">Advance Bot Options</div>
            </div>
                 <i class="uil" [ngClass]="{
                                'uil-angle-down': isOpen.ask,
                                'uil-angle-right': !isOpen.ask
                            }"></i>
          </div>
        </div>

        <div class="sidebar-item gray">
          <!-- <i class="uil uil-plug"></i>  -->
           <div class="item-header" >
             <div>
              <div class="title">Integrations</div>
            </div></div>
            </div>
      </div>

      <div *ngIf="activeSidebar === 'advance'" class="sidebar advance-sidebar">
        <div class="sidebar-header">
          <button (click)="openSidebar('main')" class="btn btn-sm btn-secondary">
            ‚Üê
          </button>
          <!-- <h4>Advance Bot Options</h4> -->
        </div>

        <div *ngFor="let action of actions" class="action-item"
          (click)="openCreateModal('Advance_Action', action.modal)" [class.disabled]="viewMode">
          <div class="">
            <img [src]="action.icon" alt="{{ action.label }} icon" class="" />
            <!-- <i [class]="action.icon" [style.color]="action.color" class="iconstyle"></i> -->
          </div>
          <div class="label">{{ action.label }}</div>
        </div>
      </div>
      <!-- Optional lock/plus controls -->
    </div>

    <div class="new_chat_content" [class.expanded]="isSidebarCollapsed">
      <!-- Header for Canvas Section -->



      <div class="canvas-header">
        <div class="canvas-header-left">
          <!-- <button class="back-btn"><span>&larr;</span></button>
    <h3 class="canvas-title">Help & Support</h3> -->
        </div>
        <div class="canvas-header-right" *ngIf="!viewMode">
          <button class="btn save-btn" (click)="saveChatbot('submit')">Save Bot</button>
          <button class="btn publish-btn" (click)="closeBotCreateion('Publish')">Publish</button>
          <button class="close-btn" (click)="closeBotCreateion('close')">&times;</button>
        </div>
        <div class="canvas-header-right" *ngIf="viewMode">
          <button class="close-btn" [routerLink]="['/bot-builder']">&times;</button>
        </div>
      </div>

      <div  id="drawflow"  (drop)="drop($event)"
        (dragover)="allowDrop($event)"></div>
    </div>

    <!-- Header for Canvas Section -->

    <div class="new_chat_right"></div>
  </div>

  <div [ngClass]="isSidebarCollapsed ? 'chatbot_button1' : 'chatbot_button'">
    <div class="bar-zoom">
      <i class="uil uil-plus" (click)="zoomEditor('zoom_in')"></i>
      <i class="uil uil-minus" (click)="zoomEditor('zoom_out')"></i>
      <i class="uil uil-expand-arrows-alt" (click)="zoomEditor('zoom_reset')"></i>
    </div>
    <div class="btn-lock">
      <i *ngIf="showLock" class="uil uil-lock-open-alt" (click)="changeMode('unlock')"></i>
      <i *ngIf="showLock == false" class="uil uil-padlock" (click)="changeMode('lock')"></i>
    </div>
  </div>
</div>



<div class="modal fade" id="sendMessage" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" role="document" style=" top: 27px; width: 32%;">
    <div class="modal-content p-4" style="background-color: #fff6f4; border-radius: 20px;">
      
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="fw-bold m-0" style="color: #6b46c1">
          {{
            cardType === 'sendText' ? 'Send Text' :
            cardType === 'sendImage' ? 'Send Image' :
            cardType === 'sendVideo' ? 'Send Video' :
            'Send Document'
          }}
        </h6>
                  <button type="button" class="btn5 btn-close" style="width: 40px" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body sendMessageBody" >
      <!-- Form -->
      <form [formGroup]="sendTextForm" (ngSubmit)="onSubmit()">

        <!-- File Upload -->
        <div *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'" class="mb-3 text-center">
          <div class="upload-box d-flex flex-column align-items-center justify-content-center mb-3 send_message"

               (click)="fileInput.click()">
            
            <ng-container *ngIf="!selectedImageUrl; else preview">
              <i class="fa fa-plus text-primary"></i>
              <label>
                {{
                  cardType === 'sendImage' ? 'Upload Image' :
                  cardType === 'sendVideo' ? 'Upload Video' :
                  'Upload Document'
                }}
              </label>
            </ng-container>

            <ng-template #preview>
              <img *ngIf="selectedFileType === 'image'" [src]="selectedImageUrl" alt="Preview" class="preview-img" style="max-height: 120px;" />
              <img *ngIf="selectedFileType === 'document'" src="assets/img/document.png" alt="Preview" class="preview-img" style="max-height: 120px;" />
              <span class="ms-2" *ngIf="selectedFileType === 'document' || cardType == 'sendDocument'">{{ fileName || uploadedFile?.name  }}</span>
              <video *ngIf="selectedFileType === 'video'" [src]="selectedImageUrl" controls style="max-height: 140px; width: 100%; border-radius: 8px;"></video>
            </ng-template>

            <input type="file" [accept]="getFileAccept()" hidden (change)="onFileSelectedData($event)" #fileInput />

            <div *ngIf="sendTextForm.get('file')?.touched && sendTextForm.get('file')?.errors?.['required']"
                 style="color: red; font-size: 12px;">
              {{
                cardType === 'sendImage' ? 'Image' :
                cardType === 'sendVideo' ? 'Video' :
                'Document'
              }} is required.
            </div>
          </div>
        </div>

        <!-- Rich Text Editor -->
        <div class="form-group">
          <div class="character-label-wrapper"> 
          <label *ngIf="cardType === 'sendText'" class="textMsg">Text Message</label>
          <span *ngIf="cardType === 'sendText'" class="character-count">Characters</span>
          </div>
          <div class="character-label-wrapper">  

          <label *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'" class="textMsg">Text Message (Optional)</label>
          <span *ngIf="cardType === 'sendImage' || cardType === 'sendVideo' || cardType === 'sendDocument'" class="character-count">Characters</span>
</div>
          <div class="rte-wrapper" style="position: relative;">
            <ejs-richtexteditor
              id="defaultRTE"
              #chatEditor
              [toolbarSettings]="semiAdvanceTool"
              [width]="'100%'"
              placeholder="Type Message..."
              (keyup)="onTextChange()"
              [pasteCleanupSettings]="pasteCleanupSettings"
              [maxLength]="1024"
              [showCharCount]="true"
              formControlName="textMessage">
            </ejs-richtexteditor>

            <!-- Bot Var Button -->
    <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown" type="button" (click)="openBotVariableModal('chatEditor')">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
  id="add-action-dropdowns"
    class="d-inline-block"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
          </div>

          <div *ngIf="sendTextForm.get('textMessage')?.touched && sendTextForm.get('textMessage')?.errors?.['required']"
               style="color: red; font-size: 12px;">
            Text is required.
          </div>
        </div>

        <!-- Footer Buttons -->
      </form>
    </div>
    <div class="d-flex justify-content-end gap-2 mt-2">
      <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
      <button type="submit" class="btn btn-primary submitButtonOfSendMessage"  (click)="onSubmit()">Save</button>
    </div>
    
    </div>
  </div>
</div>

<div class="modal fade" id="questionOption" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4 scroller" style="background-color: #fff6f4; border-radius: 20px">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="fw-bold m-0" style="color: #6b46c1; padding: 15px 0px 0px 0px;">Question Option</h6>
            <button type="button" class="btn5 btn-close" style="width: 40px; margin-right: 17px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>

      </div>
      <div class="modal-body" style="padding: 0px 24px">
        <form [formGroup]="questionOption" (ngSubmit)="onSubmit('questionOption')">
          <!-- Question Text -->
          <div class="form-group">
            <div class="character-label-wrapper">
            <label class="question_text_label">Question Text</label>
            <span class="character-count01">Characters</span>
            </div>

            <div class="rte-wrapper" style="position: relative">
              <ejs-richtexteditor id="questionRTE" #questionEditor [toolbarSettings]="semiAdvanceTool" [width]="'100%'"
                placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
                formControlName="questionText" style="" [maxLength]="1024" [showCharCount]="true">
              </ejs-richtexteditor>

 
              <div class="d-flex align-items-center gap-2">
              <button id="add-action-dropdown" type="button"  style="bottom: 20px;right: 117px;" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
  id="add-action-dropdowns" style="bottom: 21px;right: 85px;"
    class="d-inline-block"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>
          </div>

          <div class="mt-3">
        <input type="text" class="form-control" formControlName="promptMessage"
            style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
          placeholder="Please type a number from 1 to {{ options.length }} for your reply" />
      </div>
          <!-- Answer Options Section -->
          <div class="mb-4">
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 12px; display: block;">
              Add Answer Option
            </label>

            <div formArrayName="options" class="" style="background-color: #fef3f7">
              <div *ngFor="let option of options?.controls; let i = index" class="mb-3">
                <div class="d-flex align-items-center justify-content-between" style="gap: 8px; flex-wrap: wrap">
                  <div style="position: relative; flex-grow: 1; width: 100%">
                    <span style="position: absolute; top: -18px; right: 10px; font-size: 12px; color: #6b7280; z-index: 1;">
                      {{ option.value?.length || 0 }}/20 Character
                    </span>
                    <input type="text" formControlName="{{ i }}" class="form-control"
                      [attr.placeholder]="'Option ' + (i + 1)" maxlength="20"
                      style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 10px 14px; font-size: 14px; background-color: #fff; width: 100%;" />
                   <div *ngIf="option.invalid && option.touched">Option is required</div>
                    </div>

                  <!-- Remove Button -->
                  <div *ngIf="options?.controls.length > 1" class="mt-1">
                    <button type="button" class="btn btn-link p-0 text-danger removeButton"
                      (click)="removeOption(options, i)">
                      - Remove
                    </button>
                  </div>
                </div>
              </div>
              <div *ngIf="questionOption.get('options')?.errors?.atLeastOneOption" class="text-danger small mt-1">
    At least one option must be filled.
  </div>
  <div *ngIf="questionOption.get('options')?.errors?.duplicateOptions" class="text-danger small mt-1">
  Options must be unique.
</div>


              <!-- Add Option Button -->
              <button type="button" class="btn btn-link text-primary p-0"
                style="font-size: 12px; color: #6b46c1 !important; text-align: right; text-decoration: none;"
                (click)="addOption(options)">
                + Add
              </button>
            </div>

            <div *ngIf="newOptionError" class="text-danger small mt-1">
              {{ newOptionError }}
            </div>
          </div>

          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event, questionOption)" />
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="questionOption.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label class="Invalid_response_action">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName"
                  style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                  placeholder="Enter variable name" />
                <div *ngIf="questionOption.get('variableName')?.invalid && questionOption.get('variableName')?.touched"
                  class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be unique
                </div>
              </div>

              <div class="mb-2">
                <label class="Invalid_response_action">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType"
                  style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                  <option value="MultiSelect">Multi Select</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Section -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center gap-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500">Additional Validation Settings </label>


  <sb-tooltip
    class="d-inline-block"
    [tooltipText]="'Set fallback actions and retry rules for when a customer gives an invalid or no response.'"
    [isVisible]="isTooltipVisible2"
    (visibilityChange)="handleTooltipChange($event,2)"
  ></sb-tooltip>
</div>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(questionOption)" />
                <span class="slider round"></span>
              </label>
            </div>

            <div *ngIf="questionOption.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #f9fafb">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event, questionOption)" />
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="questionOption.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount"
                    style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Enter number of reattempts" />
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                   <div class="character-label-wrapper">
            <label class="Invalid_response_action" >
              Validation Error Message
              <span *ngIf="questionOption.get('reattemptsAllowed')?.value" class="text-danger">*</span>
            </label>
            
            <span class="character-count01">Characters</span>
          </div>

                <ejs-richtexteditor id="questionRTE" #errorEditor [toolbarSettings]="tools" [width]="'100%'"
                  placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
                  formControlName="errorMessage" style="" [maxLength]="1024" [showCharCount]="true">
                </ejs-richtexteditor>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label class="Invalid_response_action">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end" formControlName="invalidAction" />
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse" formControlName="enableTimeElapse"
                    (change)="onTimeElapseChange($event, questionOption)" />
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="questionOption.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes"
                    style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;"
                    placeholder="Set reply wait time in minutes" />

                    <div *ngIf="questionOption.errors?.['timeElapseExceeded'] && !viewMode" style="color: red; font-size: 12px;">
                      Time Elapse Minutes must be less than {{ botTimeout }}.
                    </div>

                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary"
              style="background-color: #6b46c1; border: none; margin-left: 11px">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="openQuestion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4 scroller" style="background-color: #fff6f4; border-radius: 20px">
      <!-- Header -->
      <div class="modal-header" style="border-bottom: none;">
        <h5 class="modal-title fw-semibold" style="color: #6b46c1">Open Question</h5>
                <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body" style="padding: 16px 24px">
        <form [formGroup]="openQuestion" (ngSubmit)="onSubmit('openQuestion')">
          <!-- Question Text -->
          <div class="form-group">
         
              
 

                 <div class="character-label-wrapper">
            <label class="question_text_label">Question Text</label>
            <span class="character-count01">Characters</span>
            </div>
            



            <div class="rte-wrapper" style="position: relative">
              <ejs-richtexteditor id="questionRTE" #questionEditor [toolbarSettings]="semiAdvanceTool" [width]="'100%'"
                placeholder="Enter question..." [pasteCleanupSettings]="pasteCleanupSettings"
                formControlName="questionText" (change)="updateQuestionTextLength(questionEditor)" style=""
                [maxLength]="1024" [showCharCount]="true">
              </ejs-richtexteditor>

              <!-- <button id="add-action-dropdown-Wp" type="button" (click)="openBotVariableModal()">
                <img src="assets/img/teambox/add.svg" /> Bot var
              </button> -->
              <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="bottom: 20px;right: 117px;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
  id="add-action-dropdowns"
   style="bottom: 21px;right: 85px;"
    class="d-inline-block"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>
          </div>

          <!-- Save Answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event, openQuestion)" />
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="openQuestion.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    " placeholder="Enter variable name" />
                <div *ngIf="
                                        openQuestion.get('variableName')?.invalid &&
                                        openQuestion.get('variableName')?.touched
                                    " class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be
                  unique
                </div>
              </div>

              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    ">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                  <option value="MultiSelect">Multi Select</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center gap-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500">Additional Validation Settings</label>
                <sb-tooltip
    class="d-inline-block"
    [tooltipText]="'Set fallback actions and retry rules for when a customer gives an invalid or no response.'"
    [isVisible]="isTooltipVisible2"
    (visibilityChange)="handleTooltipChange($event,2)"
  ></sb-tooltip>
</div>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(openQuestion)" />
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="openQuestion.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #f9fafb">
              <!-- Answer Type Selection -->
              <div class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Select Answer Type
                </label>
                <select class="form-select" class="form-control" formControlName="answerType"
                  (change)="onAnswerTypeChange()" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 6px 4px;
                                        font-size: 14px;
                                    ">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="email">Email</option>
                  <option value="date">Date</option>
                  <option value="custom">Custom</option>
                </select>
              </div>

              <!-- Validation Fields Based on Answer Type -->
              <div *ngIf="openQuestion.get('answerType')?.value === 'text'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Minimum characters
                    </label>
                    <input type="number" min="0" class="form-control" formControlName="minChars" style="
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Maximum characters
                    </label>
                    <input type="number" min="1" class="form-control" formControlName="maxChars" style="
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                </div>
                <div class="mb-2">
                  <label style="
                                            font-size: 14px;
                                            color: #374151;
                                            font-weight: 500;
                                            margin-bottom: 8px;
                                            display: block;
                                        ">
                    Regular Expression
                  </label>
                  <input type="text" class="form-control" formControlName="textRegex" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter regex pattern" />
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'number'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Minimum number
                    </label>
                    <input type="number" class="form-control" formControlName="minNumber" style="
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Maximum number
                    </label>
                    <input type="number" class="form-control" formControlName="maxNumber" style="
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                </div>
                <div class="mb-2">
                  <label style="
                                            font-size: 14px;
                                            color: #374151;
                                            font-weight: 500;
                                            margin-bottom: 8px;
                                            display: block;
                                        ">
                    Regular Expression
                  </label>
                  <input type="text" class="form-control" formControlName="numberRegex" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter regex pattern" />
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'date'" class="mb-3">
                <div class="row">
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Minimum date
                    </label>
                    <input type="date" formControlName="minDate" format="dd/MM/yyyy" placeholder="Select date" style="
                                                width: 100%;
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                  <div class="col-md-6 mb-2">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: 8px;
                                                display: block;
                                            ">
                      Maximum date
                    </label>
                    <input type="date" formControlName="maxDate" format="dd/MM/yyyy" placeholder="Select date" style="
                                                width: 100%;
                                                border: 1px solid #e5e7eb;
                                                border-radius: 8px;
                                                padding: 10px 12px;
                                                font-size: 14px;
                                            " />
                  </div>
                </div>
              </div>

              <div *ngIf="openQuestion.get('answerType')?.value === 'custom'" class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Regular Expression
                </label>
                <input type="text" class="form-control" formControlName="customRegex" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    " placeholder="Enter regex pattern" />
              </div>

              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event, openQuestion)" />
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="openQuestion.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter number of reattempts" />
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
         <div class="character-label-wrapper">
            <label class="question_text_label">Validation Error Message</label>
            <span class="character-count01">Characters</span>
            </div>
                <ejs-richtexteditor id="errorRTE" #errorEditor [toolbarSettings]="basicTools" [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]="1024" [pasteCleanupSettings]="pasteCleanupSettings"
                  [showCharCount]="true" (change)="updateErrorMessageLength(errorEditor)" style="">
                </ejs-richtexteditor>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event, openQuestion)" />
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="openQuestion.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Set reply wait time in minutes" />
                  <div *ngIf="openQuestion.errors?.['timeElapseExceeded'] && !viewMode" style="color: red; font-size: 12px;">
                    Time Elapse Minutes must be less than {{ botTimeout }}.
                  </div>
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-primary" style="background-color: #6b46c1; border: none; margin-left: 11px">
              Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Ask Buttons Modal -->
<div class="modal fade" id="buttonOptions" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 33%">
    <div class="modal-content p-4 scroller" style="background-color: #fff6f4; border-radius: 20px">
      <!-- Header -->
      <div class="modal-header" style="border-bottom: none;">
        <h5 class="modal-title fw-semibold" style="color: #6b46c1">Button Options</h5>
                <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body" style="padding: 16px 24px">
        <form [formGroup]="buttonOptions" (ngSubmit)="onSubmit('buttonOptions')">
          <!-- Header Options -->
          <div class="mb-3">
            <div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'none'">
                <input type="radio" name="headerType" value="none" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions, 'none')" />
                none
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'text'">
                <input type="radio" name="headerType" value="text" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions, 'text')" />
                Text
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'image'">
                <input type="radio" name="headerType" value="image" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions, 'image')" />
                Image
              </label>
              <label class="radiobutton" [class.active]="buttonOptions.get('headerType')?.value === 'video'">
                <input type="radio" name="headerType" value="video" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions, 'video')" />
                Video
              </label>
              <label class="radiobutton" [class.active]="
                                    buttonOptions.get('headerType')?.value === 'document'
                                ">
                <input type="radio" name="headerType" value="document" formControlName="headerType"
                  (change)="onHeaderTypeChange(buttonOptions, 'document')" />
                Document
              </label>
            </div>

            <label *ngIf="buttonOptions.get('headerType')?.value == 'text'" [ngStyle]="{
    'margin-bottom': buttonOptions.get('headerType')?.value === 'text' ? '-30px' : '-5px'}"  class="header_text">
              Header {{ buttonOptions.get('headerType')?.value === 'text' ? '(Optional)' : '' }}
            </label>

            <!-- Header Content Based on Selection -->
            <div *ngIf="buttonOptions.get('headerType')?.value === 'text'" class="mt-3">
              <div class="d-flex justify-content-end align-items-center mb-1">
                <span style="font-size: 12px; color: #6b7280">{{ buttonOptions.get('headerText')?.value?.length || 0
                  }}/60
                  Characters</span>
              </div>
              <input type="text" class="form-control" formControlName="headerText"
                (input)="updateHeaderTextLength(buttonOptions)" class="sendMessage_header" maxlength="60" placeholder="Enter header text" />
            </div>

            <div *ngIf="['image', 'video', 'document'].includes(
                                    buttonOptions.get('headerType')?.value
                                )
                            " class="mt-3">
              <div class="d-flex justify-content-center align-items-center flex-column py-4" style="
                                    border: 1px dashed #d1d5db;
                                    border-radius: 12px;
                                    background-color: #fff;
                                    text-align: center;
                                ">
                <!-- Upload Button (shown when no file selected) -->
                <label for="mediaUpload" class="mb-2" style="cursor: pointer" *ngIf="!selectedFileUrl">
                  <div style="
                                            width: 48px;
                                            height: 48px;
                                            border-radius: 50%;
                                            background-color: #7c3aed;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                        ">
                    <span style="color: #fff; font-size: 24px">+</span>
                  </div>
                </label>

                <!-- File Input (hidden) -->
                <input id="mediaUpload" type="file" class="d-none" (change)="onFileSelectedData($event,'buttonOption')" [accept]="
                                        getFileAcceptType(buttonOptions.get('headerType')?.value)
                                    " />

                <!-- Upload Message -->
                <small class="text-muted" *ngIf="!selectedFileUrl">
                  {{ buttonOptions.get('headerType')?.value }}
                </small>

                <!-- IMAGE Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'image'" class="mt-3 text-center">
                  <img [src]="selectedFileUrl" alt="Uploaded Image" class="img-fluid rounded mb-2" style="
                                            max-width: 100%;
                                            max-height: 150px;
                                            object-fit: cover;
                                        " />
                  <!-- <button type="button" class="btn btn-link p-0 text-danger" (click)="removeFile()">Remove</button> -->
                </div>

                <!-- VIDEO Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'video'" class="mt-3 text-center">
                  <video [src]="selectedFileUrl" controls class="rounded"
                    style="max-width: 100%; max-height: 180px"></video>
                  <!-- <button type="button" class="btn btn-link p-0 text-danger" (click)="removeFile()">Remove</button> -->
                </div>

                <!-- DOCUMENT Preview -->
                <div *ngIf="selectedFileUrl && selectedFileType === 'document'" class="mt-3 text-center">
                  <div class="d-flex align-items-center justify-content-center">
                    <i class="bi bi-file-earmark-text" style="font-size: 24px; color: #6b7280"></i>
                    <span class="ms-2">{{ uploadedFile?.name }}</span>
                  </div>
                </div>

                <!-- File Size Note -->
                <div class="mt-2" style="font-size: 12px; color: #6b7280">
                  Max size:
                  {{
                  buttonOptions.get('headerType')?.value === 'image'
                  ? '5MB'
                  : '10MB'
                  }}
                </div>
              </div>

              <!-- Optional Link Field -->
            </div>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <button *ngIf="selectedFileUrl" type="button" style="font-size: 12px; text-decoration: none"
                class="btn btn-link p-0 ms-2 text-danger" (click)="removeFile()">
                Remove
              </button>
            </div>
          </div>

          <!-- Body Text -->
          <div class="mb-3">
            <div class="character-label-wrapper">
              <label class="question_text_label">Body Text</label>
              <span class="character-count01">Characters</span>
            </div>

            <div class="rte-wrapper" style="position: relative">

              <ejs-richtexteditor id="bodyRTE" #bodyEditor [toolbarSettings]="semiAdvanceTool" [width]="'100%'"
                placeholder="Enter body text..." [pasteCleanupSettings]="pasteCleanupSettings"
                formControlName="bodyText" (change)="updateBodyTextLength(bodyEditor)" style="" [maxLength]="1024"
                [showCharCount]="true">
              </ejs-richtexteditor>

              <!-- <button id="add-action-dropdown-Wp" type="button" (click)="openBotVariableModal()">
                <img src="assets/img/teambox/add.svg" /> Bot var
              </button> -->
              <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="bottom: 20px;right: 117px;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
    class="d-inline-block"
     style="bottom: 21px;right: 85px;"
    id="add-action-dropdowns"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>
          </div>

          <!-- Footer Text -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -13px;
                                display: block;
                            ">
              Footer Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">{{ buttonOptions.get('footerText')?.value?.length || 0 }}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="footerText"
              (input)="updateFooterTextLength(buttonOptions)" maxlength="60" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter footer text" />
          </div>

          <!-- Buttons Section -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: 12px;
                                display: block;
                            ">
              Buttons
            </label>

            <div formArrayName="buttons" class="" style="background-color: #fef3f7">
              <div *ngFor="let button of buttons?.controls; let i = index" class="mb-3">
                <div class="d-flex justify-content-end align-items-center mb-1" style="gap: 8px; flex-wrap: wrap">
                  <div style="
                                            font-size: 12px;
                                            color: #6b7280;
                                            min-width: 100px;
                                            text-align: right;
                                        ">
                    {{ button.value?.length || 0 }}/20 Characters
                  </div>
                  <!-- Input field for button label -->
                  <input type="text" [formControlName]="i" class="form-control flex-grow-1"
                    [attr.placeholder]="'Button ' + (i + 1)" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 12px;
                                            padding: 10px 14px;
                                            font-size: 14px;
                                            background-color: #fff;
                                        " maxlength="20" />

<div *ngIf="buttonOptions.get('buttons')?.errors?.atLeastOneRequired && buttonOptions.get('buttons')?.touched"
     class="text-danger small mt-1">
  At least one button must be filled.
</div>




                  <!-- Character count -->

                  <!-- Remove button -->
                  <button *ngIf="buttons?.controls.length > 1" type="button" class="btn btn-link text-danger p-0 ms-2"
                    style="font-size: 12px; text-decoration: none" (click)="removeButton(buttons, i)">
                    - Remove
                  </button>
                </div>
              </div>

              <div *ngIf="buttonOptions.get('buttons')?.errors?.duplicateButtons && buttonOptions.get('buttons')?.touched"
     class="text-danger small mt-1">
  Button names must be unique.
</div>
              <!-- Add Button -->
              <button type="button" *ngIf="buttons?.controls.length < 3" class="btn btn-link text-primary p-0"
                style="font-size: 12px; color: #6b46c1 !important" (click)="addButton(buttons)"   [disabled]="buttons?.at(buttons.length - 1)?.value?.trim()?.length === 0">
                + Add
              </button>

            </div>

          </div>

          <!-- Save answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event, buttonOptions)" />
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="buttonOptions.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    " placeholder="Enter variable name" />
                <div *ngIf="
                                        buttonOptions.get('variableName')?.invalid &&
                                        buttonOptions.get('variableName')?.touched
                                    " class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be
                  unique
                </div>
              </div>

              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    ">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                  <option value="MultiSelect">Multi Select</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center gap-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500">Additional Validation Settings</label>
                <sb-tooltip
    class="d-inline-block"
    [tooltipText]="'Set fallback actions and retry rules for when a customer gives an invalid or no response.'"
    [isVisible]="isTooltipVisible2"
    (visibilityChange)="handleTooltipChange($event,2)"
  ></sb-tooltip>
</div>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation"
                  (change)="onValidationToggle(buttonOptions)" />
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="buttonOptions.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #f9fafb">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event, buttonOptions)" />
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="buttonOptions.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter number of reattempts" />
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <div class="character-label-wrapper">
                  <label class="question_text_label">Validation Error Message</label>
                  <span class="character-count01">Characters</span> 
                </div>
                <ejs-richtexteditor id="errorRTE" #errorEditor [toolbarSettings]="basicTools" [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]="1024" [pasteCleanupSettings]="pasteCleanupSettings"
                  [showCharCount]="true" (change)="updateErrorMessageLength(errorEditor)" style="">
                </ejs-richtexteditor>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event, buttonOptions)" />
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="buttonOptions.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Set reply wait time in minutes" />

                          <div *ngIf="buttonOptions.errors?.['timeElapseExceeded'] && !viewMode" style="color: red; font-size: 12px;">
  Time Elapse Minutes must be less than {{ botTimeout }}.
</div>


                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-primary" style="background-color: #6b46c1; border: none; margin-left: 11px"
              [disabled]="!buttonOptions.valid || buttons?.controls.length === 0">
              Save
            </button>
          </div>

          <!-- Footer Buttons -->
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="listOptions" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4 scroller" style="background-color: #fff6f4; border-radius: 20px">
      <!-- Header -->
      <div class="modal-header" style="border-bottom: none; ">
        <h5 class="modal-title fw-semibold" style="color: #6b46c1">List Options</h5>
                <button type="button" class="btn5 btn-close" style="width: 40px; " data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body" style="padding: 16px 24px">
        <form [formGroup]="listOptions" (ngSubmit)="onSubmit('listOptions')">
          <!-- Header Text -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -15px;
                                display: block;
                            ">
              Header Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">{{ listOptions.get('headerText')?.value?.length || 0 }}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="headerText"  [maxLength]="60"
              (input)="updateHeaderTextLength(listOptions)" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter header text" />
          </div>

          <!-- Body Text -->
          <div class="mb-3">
            <div class="character-label-wrapper">
              <label class="question_text_label">Body Text</label>
              <span class="character-count01">Characters</span> 
            </div>


            <div class="rte-wrapper" style="position: relative">
              <ejs-richtexteditor id="bodyRTE" #bodyEditor [toolbarSettings]="semiAdvanceTool" [width]="'100%'"
                placeholder="Enter body text..." [pasteCleanupSettings]="pasteCleanupSettings"
                formControlName="bodyText" style="" [maxLength]="1024" [showCharCount]="true">
              </ejs-richtexteditor>



                         <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="bottom: 20px;right: 117px;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
    class="d-inline-block"
     style="bottom: 21px;right: 85px;"
    id="add-action-dropdowns"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>
          </div>

          <!-- Footer Text -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -15px;
                                display: block;
                            ">
              Footer Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">
                {{ listOptions.get('footerText')?.value?.length || 0 }}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="footerText"
              (input)="updateFooterTextLength(listOptions)" maxlength="60" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter footer text" />
          </div>

          <!-- List Configuration -->
          <div class="mb-3">
            <!-- List Header -->
            <div class="mb-3">
              <label style="
                                    font-size: 14px;
                                    color: #374151;
                                    font-weight: 500;
                                    margin-bottom: -15px;
                                    display: block;
                                ">
                List Header
              </label>
              <div class="d-flex justify-content-end align-items-center mb-1">
                <span style="font-size: 12px; color: #6b7280">{{ listOptions.get('listHeader')?.value?.length || 0 }}/20
                  characters</span>
              </div>
              <input type="text" class="form-control" formControlName="listHeader"
                (input)="updateListHeaderLength(listOptions)" maxlength="20" style="
                                    border: 1px solid #e5e7eb;
                                    border-radius: 8px;
                                    padding: 10px 12px;
                                    font-size: 14px;
                                " placeholder="Enter list header" />
            </div>

            <!-- Sections -->

            <div formArrayName="sections" *ngIf="listOptionSections">
              <div *ngFor="
                                    let section of listOptionSections.controls;
                                    let sectionIndex = index
                                " class="mb-4">
                <!-- Add this wrapper -->
                <div [formGroupName]="sectionIndex" class="border p-3 rounded-lg shadow-sm"
                  style="background-color: #ffeae6">
                  <!-- Section Heading -->
                  <div class="mb-3">
                    <label style="
                                                font-size: 14px;
                                                color: #374151;
                                                font-weight: 500;
                                                margin-bottom: -17px;
                                                display: block;
                                            ">
                      Section {{ sectionIndex + 1 }} Header (Optional)
                    </label>

                    <div class="d-flex justify-content-end align-items-center mb-1">
                      <span style="font-size: 12px; color: #6b7280">{{
                        section.get('sectionHeading')?.value?.length ||
                        0
                        }}/24 characters</span>
                    </div>
                    <input type="text" class="form-control" formControlName="sectionHeading" maxlength="24"
                      placeholder="Enter section heading" />
                  </div>

                  <!-- Rows -->
                  <div formArrayName="rows" class="space-y-3">
                    <div *ngFor="
                                                let row of getSectionRows(
                                                    listOptionSections,
                                                    sectionIndex
                                                ).controls;
                                                let rowIndex = index
                                            " class="border-b border-gray-200 pb-3">
                      <!-- Add this wrapper -->
                      <div [formGroupName]="rowIndex">
                        <div class="flex justify-between items-center mb-2">
                          <label style="
                                                            font-size: 14px;
                                                            color: #374151;
                                                            font-weight: 500;
                                                            margin-bottom: -17px;
                                                            display: block;
                                                        ">
                            Option {{ rowIndex + 1 }}
                          </label>
                        </div>
                        <div class="d-flex justify-content-end align-items-center mb-1">
                          <span style="font-size: 12px; color: #6b7280">{{
                            row.get('rowName')?.value?.length || 0
                            }}/20 characters</span>
                        </div>

                        <!-- Row Name -->
                        <div class="mb-2">
                          <input type="text" class="form-control" formControlName="rowName" maxlength="20"
                            placeholder="Enter option name"  />
                        </div>

                         <!-- Error message for uniqueness -->
  <div *ngIf="row.get('rowName')?.hasError('notUnique')" class="invalid-feedback" style="display: block;">
    Option name must be unique across all sections
  </div>
  
  <!-- Error message for other validations if needed -->
  <div *ngIf="row.get('rowName')?.invalid && (row.get('rowName')?.dirty || row.get('rowName')?.touched) 
              && !row.get('rowName')?.hasError('notUnique')" class="invalid-feedback" style="display: block;">
    Please enter a valid option name
  </div>
                        <!-- Row Description -->
                        <div>
                          <div class="d-flex justify-content-end align-items-center mb-1">
                            <span style="font-size: 12px; color: #6b7280">{{
                              row.get('rowDescription')?.value
                              ?.length || 0
                              }}/72 characters</span>
                          </div>
                          <textarea class="form-control" formControlName="rowDescription" maxlength="72"
                            placeholder="Enter description"></textarea>
                          <button type="button" class="btn btn-link p-0 text-danger removeButtonbtn" style="font-size: 12px; text-decoration: none;" (click)="removeRow(listOptionSections, sectionIndex, rowIndex)" 
                          *ngIf="!(getSectionRows(listOptionSections, sectionIndex).controls.length <= 1)">Remove
</button>
                        </div>
                      </div>
                    </div>
                    <button type="button" *ngIf="!hideAddAction" class="btn btn-link p-0"
                      (click)="addRow(listOptionSections, sectionIndex)" style="
                                                font-size: 12px;
                                                color: #6b46c1 !important;
                                                text-align: right;
                                                text-decoration: none;
                                            ">
                      + Add
                    </button>
                  </div>
                </div>
                <button type="button" class="btn btn-link p-0 text-danger removeSectionbtn"
                  (click)="removeSection(listOptionSections, sectionIndex)"
                  *ngIf="!(listOptionSections.controls.length <= 1)">
                  Remove Section
                </button>
              </div>
            </div>

            

            <button type="button" class="btn btn-link p-0" *ngIf="!hideAddAction"
              style="font-size: 12px; text-decoration: none; color: #6b46c1" (click)="addSection(listOptionSections)">
              + Add New Section
            </button>
          </div>

          <!-- Save answer as Variable -->
          <div class="mb-3">
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="saveAsVariable" formControlName="saveAsVariable"
                (change)="onSaveAsVariableChange($event, listOptions)" />
              <label class="form-check-label" for="saveAsVariable" style="font-size: 14px; color: #374151">
                Save answer as Bot Variable
              </label>
            </div>

            <div *ngIf="listOptions.get('saveAsVariable')?.value" class="ps-4">
              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Variable Name
                </label>
                <input type="text" class="form-control" formControlName="variableName" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    " placeholder="Enter variable name" />
                <div *ngIf="
                                        listOptions.get('variableName')?.invalid &&
                                        listOptions.get('variableName')?.touched
                                    " class="text-danger small mt-1">
                  Must start with a letter, only underscores allowed, and must be
                  unique
                </div>
              </div>

              <div class="mb-2">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Data Type
                </label>
                <select class="form-select" formControlName="variableDataType" style="
                                        border: 1px solid #e5e7eb;
                                        border-radius: 8px;
                                        padding: 10px 12px;
                                        font-size: 14px;
                                    ">
                  <option value="text">Text</option>
                  <option value="number">Number</option>
                  <option value="boolean">Boolean</option>
                  <option value="array">Array</option>
                  <option value="object">Object</option>
                  <option value="MultiSelect">Multi Select</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center gap-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500">Additional Validation Settings</label>
                <sb-tooltip
    class="d-inline-block"
    [tooltipText]="'Set fallback actions and retry rules for when a customer gives an invalid or no response.'"
    [isVisible]="isTooltipVisible2"
    (visibilityChange)="handleTooltipChange($event,2)"
  ></sb-tooltip>
</div>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation" (change)="onValidationToggle(listOptions)" />
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="listOptions.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #f9fafb">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event, listOptions)" />
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="listOptions.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter number of reattempts" />
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <div class="character-label-wrapper">
                  <label class="question_text_label">Validation Error Message</label>
                  <span class="character-count01">Characters</span>
                </div>
                <ejs-richtexteditor id="errorRTE" #errorEditor [toolbarSettings]="basicTools" [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]="1024" [pasteCleanupSettings]="pasteCleanupSettings"
                  [showCharCount]="true" style="">
                </ejs-richtexteditor>
                <div class="text-end" style="font-size: 12px; color: #6b7280">
                  {{ errorMessageLength }}/1024 characters
                </div>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event, listOptions)" />
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="listOptions.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Set reply wait time in minutes" />
            <div *ngIf="listOptions.errors?.['timeElapseExceeded'] && !viewMode" style="color: red; font-size: 12px;">
  Time Elapse Minutes must be less than {{ botTimeout }}.
</div>


                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" style="background-color: #6b46c1; border: none; margin-left: 11px"
              [disabled]="
                                !listOptions.valid || getTotalRowCount(listOptionSections) === 0
                            ">
              Save
            </button>
          </div>

          <!-- Footer Buttons -->
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="whatsAppFlow" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4 scroller" style="background-color: #fff6f4; border-radius: 20px">
      <!-- Header -->
      <div class="modal-header" style="border-bottom: none;">
        <h5 class="modal-title fw-semibold" style="color: #6b46c1">
          WhatsApp Flow Question
        </h5>
                <button type="button" class="btn5 btn-close" style="width: 40px; " data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body" style="padding: 16px 24px">
        <form [formGroup]="whatsAppFlowForm" (ngSubmit)="onSubmit('whatsAppFlow')">
          <!-- Header Text -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -15px;
                                display: block;
                            ">
              Header Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">{{ whatsAppFlowForm.get('headerText')?.value?.length || 0
                }}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="headerText" [maxLength]="60"
              (input)="updateHeaderTextLength(whatsAppFlowForm)" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter header text" />
          </div>

          <!-- Body Text -->
          <div class="mb-3">
            <div class="character-label-wrapper">
              <label class="question_text_label">Body Text</label>
              <span class="character-count01">Characters</span>
            </div>
            <div class="rte-wrapper" style="position: relative">
              <ejs-richtexteditor id="bodyRTE" #bodyEditor [toolbarSettings]="semiAdvanceTool" [width]="'100%'"
                placeholder="Enter body text..." [pasteCleanupSettings]="pasteCleanupSettings"
                formControlName="bodyText" style="" [maxLength]="1024" [showCharCount]="true">
              </ejs-richtexteditor>
  

                         <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="bottom: 20px;right: 117px;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
    class="d-inline-block"
     style="bottom: 21px;right: 85px;"
    id="add-action-dropdowns"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>
          </div>



          <!-- Footer Text -->
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -15px;
                                display: block;
                            ">
              Footer Text (Optional)
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">
                {{ whatsAppFlowForm.get('footerText')?.value?.length || 0 }}/60
                characters</span>
            </div>
            <input type="text" class="form-control" formControlName="footerText"
              (input)="updateFooterTextLength(whatsAppFlowForm)" maxlength="60" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter footer text" />
          </div>
          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: -15px;
                                display: block;
                            ">
              WhatsApp Form Name
            </label>
            <div class="d-flex justify-content-end align-items-center mb-1">
              <span style="font-size: 12px; color: #6b7280">
                {{
                whatsAppFlowForm.get('whatsAppFormName')?.value?.length || 0
                }}/20 characters</span>
            </div>
            <input type="text" class="form-control" formControlName="whatsAppFormName" maxlength="20" style="
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                padding: 10px 12px;
                                font-size: 14px;
                            " placeholder="Enter WhatsApp Form Name" />
          </div>

          <div class="mb-3">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: 8px;
                                display: block;
                            ">
              Select WhatsApp Form
            </label>
           <!-- <select class="form-select" formControlName="selectedForm"
  style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px 12px; font-size: 14px;">
  <option value="" disabled selected>Select a WhatsApp flow</option>
  <option *ngFor="let flow of whatsAppFormList" [value]="flow?.id">
    {{ flow?.flowname }}
  </option>
</select> -->


                <div class="custom-input-wrapper">
    <input class="form-control bg-white"
                                            type="text"
                                            name="Form"
                                            id="Form"
                                            formControlName="selectedFormName"
                                            style="cursor: pointer;"
                                            placeholder="Select a WhatsApp flow"  (click)="toggleDropdownOfForm($event)" readonly />
                                              <ul class="dropdown-list" *ngIf="isOpensForm"
                                               >
      <li *ngFor="let flow of whatsAppFormList" 
          (click)="onWhatsAppFormSelection(flow)"   style="padding: 8px 12px; 
           cursor: pointer; 
           white-space: normal; 
           word-break: break-word; 
           line-height: 1.4; 
           display: block; 
           height: auto;">
        {{ flow?.flowname}}
      </li>
    </ul>
            </div>

          </div>

          <!-- Validation Settings Toggle -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center gap-2">
              <label style="font-size: 14px; color: #374151; font-weight: 500">Additional Validation Settings</label>
                <sb-tooltip
    class="d-inline-block"
    [tooltipText]="'Set fallback actions and retry rules for when a customer gives an invalid or no response.'"
    [isVisible]="isTooltipVisible2"
    (visibilityChange)="handleTooltipChange($event,2)"
  ></sb-tooltip>
</div>
              <label class="switch">
                <input type="checkbox" formControlName="enableValidation"
                  (change)="onValidationToggle(whatsAppFlowForm)" />
                <span class="slider round"></span>
              </label>
            </div>

            <!-- Validation Settings Content -->
            <div *ngIf="whatsAppFlowForm.get('enableValidation')?.value" class="border rounded p-3"
              style="background-color: #f9fafb">
              <!-- Reattempts Allowed -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="reattemptsAllowed"
                    formControlName="reattemptsAllowed" (change)="onReattemptsChange($event, whatsAppFlowForm)" />
                  <label class="form-check-label" for="reattemptsAllowed" style="font-size: 14px; color: #374151">
                    Reattempts Allowed
                  </label>
                </div>
                <div *ngIf="whatsAppFlowForm.get('reattemptsAllowed')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control" formControlName="reattemptsCount" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Enter number of reattempts" />
                </div>
              </div>

              <!-- Validation Error Message -->
              <div class="mb-3">
                <div class="character-label-wrapper">
                  <label class="question_text_label">Validation Error Message</label>
                  <span class="character-count01">Characters</span>
                </div>
                <ejs-richtexteditor id="errorRTE" #errorEditor [toolbarSettings]="basicTools" [width]="'100%'"
                  placeholder="Enter error message..." formControlName="errorMessage" [maxLength]="1024" [pasteCleanupSettings]="pasteCleanupSettings"
                  [showCharCount]="true" style="">
                </ejs-richtexteditor>
                <div class="text-end" style="font-size: 12px; color: #6b7280">
                  {{ errorMessageLength }}/1024 characters
                </div>
              </div>

              <!-- Invalid Response Action -->
              <div class="mb-3">
                <label style="
                                        font-size: 14px;
                                        color: #374151;
                                        font-weight: 500;
                                        margin-bottom: 8px;
                                        display: block;
                                    ">
                  Invalid Response Action
                </label>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="skipQuestion" value="skip"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="skipQuestion" style="font-size: 14px; color: #374151">
                    Skip the Question
                  </label>
                </div>
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" id="moveToFallback" value="fallback"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="moveToFallback" style="font-size: 14px; color: #374151">
                    Move to Fallback
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" id="endBot" value="end"
                    formControlName="invalidAction" />
                  <label class="form-check-label" for="endBot" style="font-size: 14px; color: #374151">
                    End the Bot
                  </label>
                </div>
              </div>

              <!-- Time Elapse Settings -->
              <div class="mb-3">
                <div class="form-check mb-2">
                  <input class="form-check-input" type="checkbox" id="enableTimeElapse"
                    formControlName="enableTimeElapse" (change)="onTimeElapseChange($event, whatsAppFlowForm)" />
                  <label class="form-check-label" for="enableTimeElapse" style="font-size: 14px; color: #374151">
                    Time Elapse
                  </label>
                </div>
                <div *ngIf="whatsAppFlowForm.get('enableTimeElapse')?.value" class="ps-4">
                  <input type="number" min="1" class="form-control mb-2" formControlName="timeElapseMinutes" style="
                                            border: 1px solid #e5e7eb;
                                            border-radius: 8px;
                                            padding: 10px 12px;
                                            font-size: 14px;
                                        " placeholder="Set reply wait time in minutes" />
                                                    <div *ngIf="whatsAppFlowForm.errors?.['timeElapseExceeded'] && !viewMode" style="color: red; font-size: 12px;">
  Time Elapse Minutes must be less than {{ botTimeout }}.
</div>

                  <div class="form-check mb-2">
                    <input class="form-check-input" type="radio" id="skipOnTimeElapse" value="skip"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="skipOnTimeElapse" style="font-size: 14px; color: #374151">
                      Skip the Question
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" id="fallbackOnTimeElapse" value="fallback"
                      formControlName="timeElapseAction" />
                    <label class="form-check-label" for="fallbackOnTimeElapse" style="font-size: 14px; color: #374151">
                      Move to Fallback
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">
              Cancel
            </button>
            <button class="btn btn-primary" style="background-color: #6b46c1; border: none; margin-left: 11px"
              [disabled]="!whatsAppFlowForm.valid">
              Save
            </button>
          </div>

          <!-- Footer Buttons -->
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="setConditionsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4" style="background-color: #fff6f4; border-radius: 20px">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h5 class="modal-title" style="color: #6b46c1">Set Condition</h5>
                                    <button type="button" class="btn5 btn-close" style="width: 40px" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body scr">
        <form [formGroup]="conditionForm" (ngSubmit)="onSubmit('setCondition')">
          <div formArrayName="conditions">
            <div *ngFor="let condition of conditionsArray.controls; let i = index" [formGroupName]="i"
              class="condition-group">
              <!-- Comparator -->
              <label class="form-label">Select a Comparator</label>

              <div class="input-group mb-3">
                <div class="custom-input-wrapper">
                  <input type="text" class="custom-input" formControlName="comparator"
                    placeholder="Select variable or attribute" (focus)="isFocused = true" (blur)="isFocused = false"
                     (input)="onComparatorInput(i)" readonly
                    (keydown)="allowOnlyBackspaces($event, i, 'comparator')" (input)="onComparatorChange(i)" />
                    <!-- [readonly]="selectedFields[i]?.comparator" -->
                  <span class="toggle_attribute_condition" (click)="openAttributeOption(i, 'comparator')"></span>
                  <button type="button" class="custom-button" [class.focused]="isFocused"
                    (click)="toggleVarMenu(i, 'comparator')">
                    Bot Var
                  </button>


                </div>

                <!-- Attribute Menu -->
                <div class="bot-var-menu" [class.visible]="
                                        showAttribute?.index === i &&
                                        showAttribute?.field === 'comparator'
                                    " >
                  <div *ngFor="let variable of conditionCardAttributeList" class="bot-var-item"
                    (click)="selectVariable(i, 'comparator', variable)">
                    {{ variable.displayName }}
                  </div>
                </div>

                <!-- Bot Variable Menu -->
                <div class="bot-var-menu" [class.visible]="
                                        showVarMenuFor?.index === i &&
                                        showVarMenuFor?.field === 'comparator'
                                    ">
                  <div *ngFor="let variable of botVariables" class="bot-var-item"
                    (click)="selectVariable(i, 'comparator', variable)">
                    {{ variable.name }}
                  </div>
                </div>
              </div>

              <!-- Operator -->
              <label class="form-label">Operator</label>
              <select class="form-select mb-3" formControlName="operator" (change)="onOperatorChange(i)">
                <option value="" disabled>Select operator</option>
                <option *ngFor="let op of getOperators(getConditionGroup(i).get('comparatorType')?.value)" [value]="op">
                  {{ op }}
                </option>
              </select>

              <!-- Value -->
              <label class="form-label">Select a Value</label>
              <div class="input-group mb-3" >
                <div class="custom-input-wrapper">
                  <input type="text" class="custom-input" formControlName="value" placeholder="Select variable or attribute"
                    (input)="onValueInput(i)" (focus)="isFocused = true"  
                    (keydown)="allowOnlyBackspaces($event, i, 'value')" (blur)="isFocused = false" style="padding-right: 142px;"   [class.disabled]="isValueDisabled(getConditionGroup(i).get('operator')?.value)" />

                <span class="select_box_condition" [class.disabled]="showSelection?.index === i && showSelection?.field === 'value'"  [class.disabled]="isValueDisabled(getConditionGroup(i).get('operator')?.value)"
                (click)="openSelection(i, 'value')"   
                *ngIf="getValueInputType(i) === 'select'"></span>

                  <span class="toggle_attribute_condition" (click)="openAttributeOption(i, 'value')" [class.disabled]="isValueDisabled(getConditionGroup(i).get('operator')?.value)"></span>


                  <div class="bot-var-menu" style="margin-top: 22px;" [class.visible]="showSelection?.index === i && showSelection?.field === 'value'">
                    <div *ngFor="let variable of selectedOptions" class="bot-var-item" (click)="selectVariable(i, 'value', variable)">  {{ variable.optionName }}
                    </div>
                  </div>
     
                  <div class="bot-var-menu" style="margin-top: 22px;" [class.visible]="showAttribute?.index === i && showAttribute?.field === 'value'">
                    <div *ngFor="let variable of conditionCardAttributeList" class="bot-var-item" (click)="selectVariable(i, 'value', variable)"> {{ variable.displayName }}
                    </div>
                  </div>

                  <button type="button" class="custom-button" [class.focused]="isFocused"
                    (click)="toggleVarMenu(i, 'value')" [class.disabled]="isValueDisabled(getConditionGroup(i).get('operator')?.value)">
                    Bot Var
                  </button>
                </div>

                <!-- Value Var Menu -->
                <div class="bot-var-menu" [class.visible]="showVarMenuFor?.index === i && showVarMenuFor?.field === 'value'">
                  <div *ngFor="let variable of botVariables" class="bot-var-item"
                    (click)="selectVariable(i, 'value', variable)">
                    {{ variable.name }}
                  </div>
                </div>
              </div>




              <!-- Actions -->
              <div class="action-links mt-3">
                <a (click)="addCondition()" *ngIf="conditionsArray?.length == i + 1">+ Add Condition</a>
                <a *ngIf="conditionsArray?.length != i + 1"></a>
                <a *ngIf="conditionsArray.length > 1" class="remove" (click)="removeCondition(i)">- Remove</a>
              </div>

              <div class="logic-toggle-options" *ngIf="i < conditionsArray.length - 1" style="margin: 10px 133px">
                <div class="logic-option" [class.active]="
                                        getConditionGroup(i).get('nextJoinType')?.value === 'AND'
                                    " (click)="
                                        getConditionGroup(i).get('nextJoinType')?.setValue('AND')
                                    ">
                  <span>And</span>
                </div>
                <div class="logic-option2" [class.active]="
                                        getConditionGroup(i).get('nextJoinType')?.value === 'OR'
                                    " (click)="
                                        getConditionGroup(i).get('nextJoinType')?.setValue('OR')
                                    ">
                  <span>Or</span>
                </div>
              </div>

              <!-- <hr *ngIf="i < conditionsArray.length - 1" /> -->
            </div>
          </div>

          <!-- Save / Cancel -->


       
        </form>
      </div>
         <div class="modal-footer border-0">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" style="background-color: #6b46c1; border: none"
              [disabled]="!conditionForm.valid" (click)="onSubmit('setCondition')">
              Save
            </button>
          </div>
    </div>
  </div>
</div>

<div class="modal fade" id="assignAgentModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h5 class="modal-title" style="color: #6b46c1">Assign Conversation to Agent</h5>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-group">
          <div class="search-container mb-3">
            <!-- <i class="fas fa-search search-icon"></i> -->
            <input type="text" class="form-control search-box" placeholder="Search" [(ngModel)]="searchQuery"
              (input)="filterAgents()" />
          </div>

          <div class="agent-list">
            <div *ngFor="let agent of agentsList" class="agent-item"
              [class.active]="selectedAgentDetails?.uid === agent?.uid" (click)="selectAgent(agent)">
              <div class="agent-avatar">{{ getInitials(agent.name) }}</div>
              <div class="agent-name">{{ agent.name }}</div>
            </div>

            <div *ngIf="agentsList.length === 0" class="no-results">
              No agents found
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" [disabled]="!selectedAgentDetails"
          (click)="onSubmit('assignAgentModal')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="assigntoContactOwner" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">
          Assign conversation to contact owner
        </h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>Conversation Assign to contact owner</span>
        </div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit('assigntoContactOwner')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="UnassignConversation" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Unassign conversation</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>conversation will be moved to the Unassigned Tab</span>
        </div>
      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit('UnassignConversation')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="UpdateConversationStatus" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Update Conversation Status</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>To Update status select a value</span>

          <div class="row">
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px">
              <input type="radio" class="form-check-input" id="resolved" name="status" value="Resolved"
                [(ngModel)]="conversationActions.status" style="margin-top: 16px" />
              <label class="form-check-label" for="resolved">Resolved</label>
            </div>
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px">
              <input type="radio" class="form-check-input" id="open" name="status" value="Open" style="margin-top: 16px"
                [(ngModel)]="conversationActions.status" />
              <label class="form-check-label" for="open">Open</label>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('UpdateConversationStatus')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>




<div class="modal fade" id="UpdateContactAttribute" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header --> 
      <div class="mb-3 d-flex justify-content-between align-items-start">
         <div>
        <h6 class="fw-bold m-0" style="color: #6b46c1">Update Contact Attribute</h6>
      
 <small class="text-muted">Automatically save user input to a contact field (e.g., city, interest).</small>
 </div>
   <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                              aria-label="Close">
                              <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                  (click)="closeModal();" />
                          </button>
      </div>

      <form [formGroup]="contactAttributeForm" (ngSubmit)="onSubmit('UpdateContactAttribute')">
        <div class="modal-body scrolles">
          <!-- Select Attribute Section -->

          <div class="form-group">
            <label style="
                                font-size: 14px;
                                color: #374151;
                                font-weight: 500;
                                margin-bottom: 2px;
                            ">Select Attribute</label>
            <!-- </div> -->
            <!-- <select class="form-select" formControlName="selectedAttribute" (change)="onAttributeChange($event)" style="width: 100%; box-sizing: border-box;">
              <option value="null" disabled selected>Select attribute</option>
              <option *ngFor="let attr of currentAttributeList" [value]="attr.ActuallName" class="dropdown">
                {{ attr.displayName }}
              </option>
            </select> -->
                        <div class="custom-input-wrapper">
    <input class="form-control bg-white "
                                            type="text"
                                            name="Attribute"
                                            id="Attribute"
                                            formControlName="selectedAttributeName"
                                            style="cursor: pointer;"
                                            readonly
                                            placeholder="Select Attribute"  (click)="toggleDropdown($event)" readonly />
                                              <ul class="dropdown-list" *ngIf="isOpens">
      <li *ngFor="let attr of currentAttributeList" 
          (click)="onAttributeChangeAfterSelection(attr)">
        {{ attr.displayName }}
      </li>
    </ul>
            </div>
          </div>

          <!-- Value Input Section -->
          <div class="mb-4">
            <label style="font-size: 14px;color: #374151;font-weight: 500;margin-bottom: 2px;">Value</label>
            <!-- </div> -->
            <div class="custom-input-wrapper">
              <input type="text" class="custom-input" formControlName="selectedValue"
                *ngIf="selectedAttributeType != 'Multi Select' && selectedAttributeType != 'Select' && selectedAttributeType != 'Switch' && selectedAttributeType != 'User'"
                placeholder="Enter variable or attribute" (focus)="isFocused = true" (blur)="isFocused = false"
                (input)="onTextInputChange($event)" [readonly]="selectedFromVariable" />


              <input type="text" class="custom-input form-control" formControlName="selectedValue"
                *ngIf="selectedAttributeType == 'Multi Select' || selectedAttributeType == 'Select' || selectedAttributeType == 'Switch' || selectedAttributeType == 'User'"
                placeholder="Enter variable or attribute" (focus)="isFocused = true" (blur)="isFocused = false"
                (input)="onTextInputChange($event)"  (keydown)="selectedFromVariable ? onSelectedValueKeydown($event) : allowOnlyBackspace($event)" style="padding-right: 151px;"/>




              <span class="select_box" [class.disabled]="isUserTyping" 
                (click)="!isUserTyping && selectAttribute('option',$event)"   
                *ngIf="selectedAttributeType == 'Multi Select' || selectedAttributeType == 'Select' || selectedAttributeType == 'Switch' || selectedAttributeType == 'User'"></span>

              <span class="toggle_attributes_contactattribute" style="left: 345px;" [class.disabled]="isUserTyping"
                (click)="!isUserTyping && selectAttribute('attr',$event)"></span>

              <button type="button" class="custom-button" [class.focused]="isFocused" [disabled]="isUserTyping"
                (click)="selectAttribute('Botvar',$event)">
                Bot Var
              </button>
              <!-- <div class="dropdown-wrapper" #dropdownWrapper> -->

              <div class="bot-var-menu" [class.visible]="openDropdown.status === 'option' && selectedAttributeType != 'Multi Select'">
                <div *ngFor="let variable of selectedOptions" class="bot-var-item" (click)="selectedValues(variable,'option')">
                  {{ variable.optionName }}
                </div>
              </div>

      <div class="bot-var-menu" 
     [class.visible]="openDropdown.status === 'option' && selectedAttributeType == 'Multi Select'" 
     (click)="$event.stopPropagation()"> <!-- Prevent closing on click -->
  <div *ngFor="let variable of selectedOptions" class="bot-var-item">
    <input 
      type="checkbox"
      [checked]="isSelected(variable)"
      (change)="toggleSelection(variable)"
    />
    <label class="label_contact">{{ variable.optionName }}</label>
  </div>
</div>


              <!-- Attribute Menu -->
              <div class="bot-var-menu" [class.visible]="openDropdown.status === 'attr'">
                <div *ngFor="let variable of currentAttributeList" class="bot-var-item"
                  (click)="selectedValues(variable)">
                  {{ variable.displayName }}
                </div>
              </div>
              <div class="bot-var-menu" [class.visible]="openDropdown.status === 'Botvar'">
                <div *ngFor="let variable of botVariables" class="bot-var-item" (click)="selectedValues(variable)">
                  {{ variable.name }}
                </div>
              </div>
              </div>
            <!-- </div> -->
          </div>

          <!-- Operation Section -->
          <div class="mb-4" *ngIf="contactAttributeForm.get('selectedAttribute')?.value">
            <h6></h6>
            <label style="font-size: 14px; color: #374151; font-weight: 500; margin-bottom: 2px;">
              Operation
            </label>
            <div class="form-check form-check-inline inlinebutton">
              <input class="form-check-input" type="radio" id="replace" formControlName="operation" value="replace"
                class="buttonMargin" />
              <label class="form-check-label" for="replace">Replace</label>
            </div>
            <div class="form-check form-check-inline inlinebutton">
              <input class="form-check-input" type="radio" id="addIfEmpty" formControlName="operation"
                class="buttonMargin" value="addIfEmpty" />
              <label class="form-check-label" for="addIfEmpty">Add If Empty</label>
            </div>
            <div class="form-check form-check-inline inlinebutton"
              *ngIf="selectedAttributeType == 'Multi Select'">
              <input class="form-check-input" type="radio" id="append" formControlName="operation" value="append"
                class="buttonMargin" />
              <label class="form-check-label" for="append">Append</label>
            </div>
          </div>

        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!contactAttributeForm.valid">
            Save
          </button>
        </div>
      </form>
    </div>
  </div>
</div>



<!-- tag-selection-modal.component.html -->
<!-- tag-selection-modal.component.html -->
<div class="modal fade" id="AddTags" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Add Tags</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>Select one or more tags to apply</span>

          <!-- Search input -->
          <div class="form-group mt-3 mb-3">
            <input type="text" class="form-control" placeholder="Search tags..." [(ngModel)]="searchTerm"
              (input)="filterTags('addTag')" />
          </div>

          <!-- Tag list with checkboxes and colored labels -->
          <div class="tag-list insideScroller">
            <div class="form-check mt-2" *ngFor="let tag of addTagList">
              <input type="checkbox" class="form-check-input" [id]="'tag-' + tag.ID"
                [checked]="isTagSelected(tag.ID)"
                (change)="toggleTagSelection(tag)"
                style="margin-top: 16px" />
              <label class="form-check-label" [for]="'tag-' + tag.TagName">
                <span class="tag-dot" [style.background]="tag.TagColour"></span>
                <span class="tag-text" [class.font-weight-bold]="
                                        tag.TagName === 'Paid' || tag.TagName === 'Return'
                                    ">
                  {{ tag.TagName }}
                </span>
              </label>
            </div>

            <span *ngIf="addTagList.length <= 0" style="    text-align: center;margin: 27px;">No record found</span>

          </div>
        </div>

        <div class="operation-options mt-4">
          <label class="form-label fw-bold d-block mb-2">Operation</label>
          <div class="form-check form-check-inline inlinebutton">
            <input type="radio" class="form-check-input" id="addIfEmpty" name="operation" value="addIfEmpty"
              class="buttonMargin" [(ngModel)]="operationOptions" />
            <label class="form-check-label" for="addIfEmpty">Add If Empty</label>
          </div>
          <div class="form-check form-check-inline inlinebutton">
            <input type="radio" class="form-check-input" id="replace" name="operation" value="replace"
              class="buttonMargin" [(ngModel)]="operationOptions" />
            <label class="form-check-label" for="replace">Replace</label>
          </div>
          <div class="form-check form-check-inline inlinebutton">
            <input type="radio" class="form-check-input" id="append" name="operation" value="append"
              class="buttonMargin" [(ngModel)]="operationOptions" />
            <label class="form-check-label" for="append">Append</label>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light me-2" (click)="onCancel()">
            Cancel
          </button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('AddTags')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="RemoveTag" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;top:39px">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Remove Tags</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>Select one or more tags to apply</span>

          <!-- Search input -->
          <div class="form-group mt-3 mb-3">
            <input type="text" class="form-control" placeholder="Search tags..." [(ngModel)]="searchTerm"
              (input)="filterTags('removeTag')" />
          </div>

          <!-- Tag list with checkboxes and colored labels -->
          <div class="tag-list insideScroller">
            <div class="form-check mt-2" *ngFor="let tag of removeTagList">
              <input type="checkbox" class="form-check-input" [id]="'tag-' + tag.ID"
               [checked]="isTagSelectedRemove(tag.ID)"
                (change)="toggleTagSelectionRemove(tag)"
                style="margin-top: 16px" />
              <label class="form-check-label" [for]="'tag-' + tag.ID">
                <span class="tag-dot" [style.background]="tag.TagColour"></span>
                <span class="tag-text" [class.font-weight-bold]="
                                        tag.TagName === 'Paid' || tag.TagName === 'Return'
                                    ">
                  {{ tag.TagName }}
                </span>
              </label>
            </div>
             <span *ngIf="removeTagList.length <= 0" style="    text-align: center;margin: 27px;">No record found</span>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light me-2" (click)="onCancel()">
            Cancel
          </button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('RemoveTag')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="MessageOptin" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Message Opt-in</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <div class="condition-groupchat">
          <span>To Update Message Opt-in select a value</span>

          <div class="row">
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px">
              <input type="radio" class="form-check-input" id="Yes" name="Yes" value="Yes"
                [(ngModel)]="conversationActions.status" style="margin-top: 16px" />
              <label class="form-check-label" for="Yes">Yes</label>
            </div>
            <div class="form-check mt-2" style="margin: 27px 41px 10px 10px">
              <input type="radio" class="form-check-input" id="No" name="status" value="No" style="margin-top: 16px"
                [(ngModel)]="conversationActions.status" />
              <label class="form-check-label" for="No">No</label>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('MessageOptin')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- time-delay-modal.component.html -->
<div class="modal fade" id="TimeDelayModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Add Time Delay</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body">
        <div class="time-delay-controls">
          <div class="row align-items-center">
            <div class="col-4">
              <label class="form-label">Time</label>
              <input type="number" class="form-control" style="width: 80px" [min]="1"
                [max]="delayUnit === 'hour' ? 24 : delayUnit === 'minute' ? 1440 : 86400"  (change)="validateTime()" [(ngModel)]="delayTime" 
                placeholder="10" />
            </div>
            <div class="col-4">
              <label class="form-label">Seconds/Minute/Hour</label>
              <select class="form-select" style="width: 120px" [(ngModel)]="delayUnit" (change)="onUnitChange()">
                <option value="seconds">seconds</option>
                <option value="minute">Minute</option>
                <option value="hour">Hour</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer border-0 mt-4">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('TimeDelayModal')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- bot-trigger-modal.component.html -->
<div class="modal fade" id="BotTriggerModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 400px">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Bot Trigger</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body">
        <div class="mb-3">
          <p class="text-muted small">
            This node will trigger another bot and terminate the current Bot
          </p>
        </div>

<div class="form-group mb-4">
  <label class="form-label">Select Bot to Trigger</label>
  <!-- <select class="form-select" [(ngModel)]="selectedBotId" (ngModelChange)="getSelectedBot($event)">
    <option value="" disabled>Select bot</option>
    <ng-container *ngFor="let bot of botsList">
      <option *ngIf="bot.status === 'publish'" [ngValue]="bot.id">
        {{ bot.name }}
      </option>
    </ng-container>
  </select> -->

                  <div class="custom-input-wrapper">
    <input class="form-control bg-white "
                                            type="text"
                                            name="bot"
                                            id="bot"
                                            [(ngModel)]="selectedBotName" 
                                            style="cursor: pointer;"
                                            readonly
                                            placeholder="Select bot"  (click)="toggleDropdownbot($event)" readonly />
                                              <!-- <ul class="dropdown-list" *ngIf="isOpens">
      <li *ngFor="let bot of botsList"  *ngIf="bot.status === 'publish'"
          (click)="onAttributeChangeAfterSelection(bot)">
        {{ bot.name }}
      </li>
    </ul> -->
    <ul class="dropdown-list" *ngIf="botDropDownStatus">
  <ng-container *ngFor="let bot of botsList">
    <li *ngIf="bot.status === 'publish'" (click)="selectBot(bot)">
      {{ bot.name }}
    </li>
  </ng-container>
</ul>

            </div>
</div>


      </div>

      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" [disabled]="!selectedBotId" (click)="onSubmit('BotTriggerModal')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="NotificationModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%;top: 60px;">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="mb-3 d-flex justify-content-between align-items-start">
          <div>
        <h6 class="modal-title" style="color: #6b46c1">Notify</h6>
         <small class="text-muted">Trigger an internal alert or message to your team when a condition is met.</small>
          </div>
                  <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <form [formGroup]="notificationForm">
          <!-- Select Agents -->

          <div class="form-group mb-4">
            <label class="form-label">Select Agent</label>
            <select class="form-control" formControlName="selectedAgentIds" style="padding: 0px 17px"
              (change)="onAgentChange($event)">
              <option value="null" disabled>Select Agent</option>
              <option *ngFor="let agent of agentsList" [value]="agent.uid">
                {{ agent.name }} ({{ agent.IsActive == 1? 'Active':'Inactive'}})
              </option>
            </select>
          </div>
          <!-- Message -->
          <div class="form-group mb-3">
            <!-- <label class="form-label">Notification Message</label>
            <div class="text-end" style="font-size: 13px; color: #6b7280; margin-left: 316px">
              Characters
            </div> -->

               <div class="character-label-wrapper">
            <label class="question_text_label">Notification Message</label>
            <span class="character-count02">Characters</span>
            </div>
            
            <ejs-richtexteditor id="defaultRTE" [insertImageSettings]="insertImageSettings" #chatEditorElement
              [toolbarSettings]="attachementTool" [width]="'90%'" [maxLength]="1024" [showCharCount]="true"
              placeholder="Type Message..." [pasteCleanupSettings]="pasteCleanupSettings" formControlName="textMessage">
            </ejs-richtexteditor>
                                     <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="right: 116px;
    top: 406px;
    bottom: auto !important;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <!-- <sb-tooltip
    class="d-inline-block"
     style="bottom: 20px;right: 49px; "
    id="add-action-dropdowns"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip> -->
</div>
          </div>
        </form>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" [disabled]="!notificationForm.valid" (click)="onSubmit('NotificationModal')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="WorkingHoursModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="modal-header border-0">
        <h6 class="modal-title" style="color: #6b46c1">Working Hours</h6>
                 <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body" style="margin: 12px">
        <p class="mb-3" style="font-size: 12px">
          This card sets the bot's active schedule. During the specified working hours,
          the bot will be marked as <b>"open" </b> and will execute all connected flows.
          Outside of these hours, it will automatically switch to the
          <b>"closed"</b> flow, ensuring appropriate behavior around the clock.
        </p>

        <div style="color: red; font-size: 17px">
          <small>
            Note: If working hours are not set in organization settings, the bot will
            assume you're available 24/7.
          </small>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="onSubmit('WorkingHoursModal')">
          Save
        </button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="NotesMentionModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered custom-modal" style="width: 32%">
    <div class="modal-content p-4">
      <!-- Modal Header -->
      <div class="mb-3 d-flex justify-content-between align-items-start">
         <div>
        <h6 class="modal-title" style="color: #6b46c1">Notes and Mention</h6>
         <small class="text-muted">Add an internal note or &#64;mention a teammate. This message will appear in the Notes section inside Team Box.</small>
         </div>         
         <button type="button" class="btn5 btn-close" style="width: 40px;" data-bs-dismiss="modal"
                                aria-label="Close">
                                <img style="width: 10px" src="assets/img/teambox/icon-close.svg"
                                    (click)="closeModal();" />
                            </button>
      </div>

      <div class="modal-body scrolles">
        <form [formGroup]="notesmentionForm">
          <!-- Select Agents -->

          <!-- Message -->
          <div class="form-group mb-3">

            <!-- <div class="text-end" style="font-size: 13px; color: #6b7280; margin-left: 316px">
              Characters
            </div> -->

            <div class="character-label-wrapper01">
              <label class="question_text_label"></label>
              <span class="character-count02">Characters</span>
            </div>
            <div class="rte-wrapper" style="position: relative">
              <ejs-richtexteditor id="mention_integration" [insertImageSettings]="insertImageSettings" id="defaultRTE"
                #chatEditors [toolbarSettings]="tools" [width]="'90%'" [maxLength]="1024" [showCharCount]="true" 
                placeholder="Type Message..." [pasteCleanupSettings]="pasteCleanupSettings" formControlName="message">
              </ejs-richtexteditor>

              <!-- Bot Var Button Positioned Absolutely Within RTE Wrapper -->
              <!-- <button id="add-action-dropdown" type="button" (click)="openBotVariableModal()">
                <img src="assets/img/teambox/add.svg" /> Bot var
              </button> -->
                         <div class="d-flex align-items-center gap-2">
  <button id="add-action-dropdown"  style="bottom: 20px;right: 79px;" type="button" (click)="openBotVariableModal()">
    <img src="assets/img/teambox/add.svg" alt="Add Icon" /> Bot var
  </button>

  <sb-tooltip
    class="d-inline-block"
     style="bottom: 20px;right: 49px; "
    id="add-action-dropdowns"
    [tooltipText]="'Use this to store user responses and reuse them later in the bot flow.'"
    [isVisible]="isTooltipVisible"
    (visibilityChange)="handleTooltipChange($event)"
  ></sb-tooltip>
</div>
            </div>

            <div *ngIf="showMention" class="popup-dialog mention upperIndex" (click)="stopPropagation($event)">
               <div class="d-flex ">
              <p class="label">&#64;mention</p>
               <button class="close-btn" style="padding: 0px;
    width: 39px;
    height: 24px;border: none;" (click)="showMention = false">
      <i class="uil uil-times"></i> <!-- Using Uicons for the cross -->
    </button>
    </div>

              <p *ngFor="let user of agentsList; let k = index" (click)="InsertMentionOption(user)">
                <span *ngIf="user.uid != userDetails.uid" class="user-img">
                  <div class="img">
                    {{ settingService.getInitials(user.name) }}
                  </div>
                  {{ user.name }} {{ user?.UserType == 'Admin' ? '(Admin)' : '' }}
                </span>
              </p>
              <div class="p-4" *ngIf="shouldShowNoData">
                <p>No Data Available.</p>
              </div>
            </div>
          </div>
        </form>

        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="onCancel()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="onSubmit('NotesMentionModal')">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" id="attachfle" #attachfle data-bs-backdrop="static" role="dialog">
  <!-- <div *ngIf="messageMediaFile==''" class="modal fade" tabindex="-1" id="attachfle" #attachfle data-bs-backdrop="static" role="dialog"> -->
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body" style="height: 380px">
        <div #attachmentbox class="teambox-white">
          <div class="modal-header">
            <div class="modal-header-left">
              <h4 class="modal-title" id="modal-basic-title"></h4>
            </div>
            <div class="modal-header-right">
              <p *ngIf="this.isAttachmentMedia == false" class="close-box" aria-label="Close" (click)="closeAllModal()">
                <img src="assets/img/teambox/icon-close.svg" />
              </p>
              <p *ngIf="this.isAttachmentMedia == true" class="close-box" aria-label="Close" (click)="closeEditMedia()">
                <img src="assets/img/teambox/icon-close.svg" />
              </p>
            </div>
          </div>
          <div class="modal-body attachmentboxbody">
            <div class="header-line">
              <h4>
                {{
                isAttachmentMedia == true ? 'Replace&nbsp;Media' : 'Attachfile'
                }}
              </h4>
              <h4>Instructions</h4>
            </div>
            <div class="attachmentbox">
              <div class="attachmentbox_left" ngClass="{{ dragAreaClass }}">
                <img class="icon" src="/assets/img/teambox/image-a@2x.png" />
                <p>Drag & Drop file</p>
                <p><span>OR</span></p>
                <sb-loader [isLoading]="isUploadingLoader" [loaderType]="'small'" [message]="''"></sb-loader>
                <label class="custom-file-upload">
                  <input type="file" #file accept="image/*, application/msword, application/pdf, video/*"
                    [multiple]="false" (change)="onFileChange($event)" (click)="$event.target.value = null"
                    style="display: none" />
                  <img class="icon" src="/assets/img/teambox/upload.png" /> Browse
                  files
                </label>
              </div>
              <div class="attachmentbox_right">
                <div>
                  <p>
                    Media file attachment must fulfill following
                    requirements:<br />
                    1) Images should be JPEG or PNG with maximum size of 5
                    MB.<br />
                    2) Video should be MP4 with maximum size of 10 MB.<br />
                    3) Document should be PDF with maximum size of 10 MB.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" id="sendfile" #sendfile data-bs-backdrop="static" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div *ngIf="messageMediaFile != ''" class="message_meida_preview">
          <div class="modal-header">
            <div class="modal-header-left"></div>
            <div class="modal-header-right">
              <p class="close-box" aria-label="Close" (click)="closeAllModal()">
                <img src="assets/img/teambox/icon-close.svg" />
              </p>
            </div>
          </div>
          <div class="modal-body message_meida_preview_body">
            <img class="preview_icon" *ngIf="this.mediaType == 'video/mp4'"
              src="/assets/img/teambox/video_preview.png" />
            <img class="preview_icon" *ngIf="this.mediaType == 'text/plain'"
              src="/assets/img/teambox/doc_preview.png" />
            <img class="preview_icon" *ngIf="this.mediaType == 'application/pdf'"
              src="/assets/img/teambox/doc_preview.png" />

            <img class="mediaFile" *ngIf="this.mediaType == 'image/jpeg'" src="{{ this.messageMediaFile }}" />
            <img class="mediaFile" *ngIf="this.mediaType == 'image/jpg'" src="{{ this.messageMediaFile }}" />
            <img class="mediaFile" *ngIf="this.mediaType == 'image/png'" src="{{ this.messageMediaFile }}" />
            <img class="mediaFile" *ngIf="this.mediaType == 'image/webp'" src="{{ this.messageMediaFile }}" />
          </div>

          <div class="input_group_btn" id="senddoc">
            <button type="button" class="submit-btn" (click)="attachMedia(messageMediaFile, mediaType)">
              Attach
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" id="atrributemodal" #atrributemodal data-bs-backdrop="static" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body custom_modal bg-pink">
        <div class="sm attributes">
          <div class="modal-header">
            <div class="modal-header-left">
              <h4 class="modal-title" id="modal-basic-title">Attributes</h4>
            </div>
            <div class="modal-header-right">
              <p class="close-box" aria-label="Close" (click)="closeAllModal()">
                <img src="assets/img/teambox/icon-close.svg" />
              </p>
            </div>
          </div>
          <div class="modal-body quickResponse">
            <input class="search-box" type="search" placeholder="Search" [(ngModel)]="attributesearch" />
            <div class="items_list">
              <div *ngFor="let alist of attributeList | searchfilter: attributesearch" class="attribute"
                (click)="selectVariables(alist)">
                <p class="label">
                  <img src="assets/img/teambox/attribute.svg" /> {{ alist }}
                </p>
              </div>
            </div>

            <div class="fallback-section mt-4">
              <label class="fallback-label">Fallback</label>
              <input class="form-control fallback-input" type="text" placeholder="Enter value"
                [(ngModel)]="fallbackValue" />
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-light" (click)="closeAllModal()">Cancel</button>
            <button type="button" class="btn btn-primary" (click)="applyAttribute()">Done</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" id="botVariable" #botVariable data-bs-backdrop="static" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body custom_modal bg-pink">
        <div class="sm attributes">
          <div class="modal-header">
            <div class="modal-header-left">
              <h4 class="modal-title" id="modal-basic-title">Bot Variable</h4>
            </div>
            <div class="modal-header-right">
              <p class="close-box" aria-label="Close" (click)="closeAllModal()">
                <img src="assets/img/teambox/icon-close.svg" />
              </p>
            </div>
          </div>
          <div class="modal-body quickResponse">
            <input class="search-box" type="search" placeholder="Search" [(ngModel)]="attributesearch" />
            <div class="items_list">
              <div *ngFor="let alist of botVariables | searchfilter: attributesearch" class="attribute"
                (click)="selectVariables(alist.name)">
                <p class="label">{{ alist.name }}</p>
              </div>
            </div>
            <div *ngIf="botVariables.length <= 0">Please Add bot Variable</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="modal fade modal-smart-reply-open" id="draft" tabindex="-1" aria-labelledby="exampleModalLabel"
  data-bs-backdrop="static" aria-hidden="true">
  <div class="modal-dialog deleteBot-dialog">
    <div class="modal-content deleteBot-content">

      <div class="modal-body deleteBot-body">
        Do you want to save your changes before exit.
      </div>
      <div class="deletefile d-flex">
        <button type="button" class="btn9 btn-secondary" style="margin: 112px 22px 0px 44px;" data-bs-dismiss="modal"
          [routerLink]="['/bot-builder']">No, Exit</button>
        <button type="button" class="btn99 btn-primary" data-bs-dismiss="modal" (click)="saveChatbot('submit','exit')">Yes,
          Save</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade modal-smart-reply-open" id="Publish" tabindex="-1" aria-labelledby="exampleModalLabel"
  data-bs-backdrop="static" aria-hidden="true">
  <div class="modal-dialog deleteBot-dialog">
    <div class="modal-content deleteBot-content">

      <div class="modal-body deleteBot-body">
        Attention! This will publish the Bot for everyone and you will not be able to make any further changes.
      </div>
      <div class="deletefile d-flex">
        <button type="button" class="btn9 btn-secondary" style="margin: 112px 22px 0px 44px;"
          data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn99 btn-primary" data-bs-dismiss="modal"
          (click)="saveChatbot('other')">Confirm</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade modal-smart-reply-open" id="deletBotCard" tabindex="-1" aria-labelledby="exampleModalLabel"
  data-bs-backdrop="static" aria-hidden="true">
  <div class="modal-dialog deleteBot-dialog">
    <div class="modal-content deleteBot-content1">

      <div class="modal-body deleteBot-body" style="
    font-weight: 600;
    font-family: Manrope;
    font-size: 12px;
    max-width: 212px;
    margin-left: 38px;
    margin-top: 0px;
    text-align: center;">
        Do you really want to delete this card

      </div>
       
      <div class="deletefile d-flex">
        <button type="button" class="cancel-btn btn-secondary" style="margin: 47px 17px 10px 44px;"
          data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn99 btn-primary" data-bs-dismiss="modal"
          (click)="ConfirmdeleteBot()">Yes, Delete</button>
      </div>
    </div>
  </div>
</div>



	