<div class="setting-card" >
    <div class="default-actions-heading pb-4">Default Messages</div>
    <div class=" grid-view p-2 px-4" >
        <div *ngFor="let data of defaultMessageDataInit; let idx = index" (click)="populateData(data)">
            <div class="flex-row">
                <span class="sub-heading">{{data.title}} </span>
                <span *ngIf="data.Is_disable==0" class="enable">Enable</span>
                <span *ngIf="data.Is_disable==1 || data.Is_disable==null" class="disable">Disabled</span>
            </div>
            <div class="sub-contents">
                <p>{{data.description}}</p>
                <button *ngIf="!data.uid"  class="white-btn" data-bs-toggle="modal" (click)="selectedButtonType(idx)" data-bs-target="#welcomGreeting">
                 <img src="../../../../assets/img/teambox/add.svg" class="pr-1"> Configure </button>
                 <button *ngIf="data.uid" class="white-btn" (click)="ToggleSideBar()">View & Manage</button>
            </div>
          </div>
    </div>

    <div class="default-footer">
        <button type="button" class="account-btn" >Save</button>
    </div>

    <div class="modal fade" tabindex="-1" id="welcomGreeting" data-bs-backdrop="static" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content welcomGreeting p-2">
                <div class="d-flex justify-content-between align-items-center modal-header">
                    <h5 *ngIf="selectedCategory == 0" class="modal-title">Add Message for Welcome Greeting</h5>
                    <h5 *ngIf="selectedCategory == 1" class="modal-title">Add Message for No Agent Reply</h5>
                    <h5 *ngIf="selectedCategory == 2" class="modal-title">Add Message for Out of Office</h5>
                    <h5 *ngIf="selectedCategory == 3" class="modal-title">Add Message for No Customer Reply Reminder</h5>
                    <h5 *ngIf="selectedCategory == 4" class="modal-title">Add Message for All Agents Offline</h5>
                    <h5 *ngIf="selectedCategory == 5" class="modal-title">Add Message for No Customer Reply Timeout</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <img src="../../../../assets/img/teambox/icon-close.svg">
                    </button>
                </div>
                <form [formGroup]="defaultMessageForm" (ngSubmit)="addDefaultMessageData()">
                <div class="modal-body px-5 pt-0">
                    <div *ngIf="selectedCategory==1" class="d-inline-block flex-column sel-type-link pb-3">
                        <label for="link" class="linkch" >Agent Reply Timeout Period</label>
                        <select class="input-form" formControlName="autoreply"  id="linken"  required >
                            <option  [disabled]="true" [selected]="true" [hidden]="true"  value="0" selected >Select no. of minutes</option>
                            <option></option>
                        </select>
                     </div>
                    <div class="d-flex justify-content-between align-items-center sel-type-btns">
                        
                        <input type="radio" id="sel-text" name="sel-type" (change)="showMessageType('text')" checked><label [ngClass]="{'radio-label': selectedType === 'text'}" class="m-0" for="sel-text">Text</label>
                        <input type="radio" id="sel-image" name="sel-type" (change)="showMessageType('image')"><label [ngClass]="{'radio-label': selectedType === 'image'}"  class="m-0" for="sel-image">Image</label>
                        <input type="radio" id="sel-video" name="sel-type" (change)="showMessageType('video')"><label [ngClass]="{'radio-label': selectedType === 'video'}"  class="m-0" for="sel-video">Video</label>
                        <input type="radio" id="sel-document" name="sel-type"(change)="showMessageType('document')"><label [ngClass]="{'radio-label': selectedType === 'document'}" class="m-0" for="sel-document">Document</label>
                      
                    </div>

                    <div class="sel-type-text-container">
                        <div *ngIf="selectedType === 'text'" class="d-flex justify-content-between align-items-center pt-3 pb-2 msg-head">
                            <h6>Message</h6> <span>Characters</span>
                         </div>

                         <div *ngIf="selectedType === 'text'" class="sel-type-text">
                             <ejs-richtexteditor [(value)]="value" id='defaultRTE' #chatEditor [toolbarSettings]='tools'
                             [maxLength]='1024' (change)="onEditorChange(chatEditor.value)" [showCharCount]='true' placeholder="Enter">
                            </ejs-richtexteditor>
                         </div>
                    </div>

                   <div *ngIf="selectedType === 'image'" class="my-4 sel-type-image">
                      <input type="file" accept="image/jpeg, image/png" formControlName="link" (change)="previewImageAndVideo($event)" id="sel-type-image">

                        <div *ngIf="defaultMessageForm.get('link')?.value == null">
                        <label class="type_label" for="sel-type-image"><img src="../../../../assets/img/teambox/add-white.svg" /></label>
                        <p class="m-0">Upload or enter link of image</p>
                       </div> 
                        <div class="main-preview-type-image" *ngIf="defaultMessageForm.get('link')?.value !== null" [ngStyle]="{'background-image': 'url(' + selectedPreview + ')'}">
                            <span class="p-2 text-right" (click)="removeValue()"><img src="../../../../assets/img/settings/remove.svg" /></span>
                        </div>
                    </div>

                   <div *ngIf="selectedType === 'video'" class=" mt-2 mb-1 sel-type-video">
                    <input type="file" accept="video/mp4"  formControlName="link" name="video-upload" (change)="onFileChange($event)" id="sel-type-video">
                    <label *ngIf="!selectedPreview" class="type_label" for="sel-type-video"><img src="../../../../assets/img/teambox/add-white.svg" /></label> 

                    <div class="video-player">
                        <span *ngIf="selectedPreview" class="p-2 text-right main-preview-type-video" (click)="removeValue()">
                          <img src="../../../../assets/img/settings/remove.svg" />
                        </span>
                      <video [src]="selectedPreview" type="video/mp4" controls #videoPlayer></video>
                    </div>       
                  </div>

                   <div *ngIf="selectedType === 'document'" class="my-4 sel-type-image" [ngClass]="{'document-selected':defaultMessageForm.get('link')?.value !== null}">
                    <div class="main-preview-type-doc" *ngIf="defaultMessageForm.get('link')?.value !== null">
                        <span class="p-2" (click)="removeValue()"><img src="../../../../assets/img/settings/remove.svg" /></span>
                    </div>
                    <img *ngIf="defaultMessageForm.get('link')?.value !== null" src="../../../../assets/img/settings/doc.svg" />
                    <span class="document-preview" *ngIf="defaultMessageForm.get('link')?.value !== null" >{{ this.fileName }}</span>
                    <span class="document-preview" *ngIf="defaultMessageForm.get('link')?.value !== null && !this.fileName" >Doc Uploaded Through link</span>
                        <input type="file" accept=".doc, .docx, .pdf" formControlName="link" (change)="onFileChange($event)" name="document-select" id="sel-type-document">
                        <div *ngIf="defaultMessageForm.get('link')?.value == null">
                        <label class="type_label" for="sel-type-document"><img src="../../../../assets/img/teambox/add-white.svg" /></label>
                        <p class="m-0">Upload or enter link of document</p>
                       </div>
                         
                </div>


             <div *ngIf="selectedType !== 'text'" >

                <div class="d-inline-block flex-column sel-type-link">
                    <label for="link" id="link" >Link</label>
                    <input type="url" id="link" formControlName="link" [attr.disabled]="defaultMessageForm.get('link')?.value !== null ? 'disabled' : null"
                       (change)="uploadThroughLink()" placeholder="Enter">
                   </div>


                   <div class="d-flex justify-content-between align-items-center pt-3 pb-2 msg-head">
                    <h6>Body Text</h6> <span>Characters</span>
                 </div>
                    <div class="sel-type-text">
                        <ejs-richtexteditor [(value)]="value" id='defaultRTE' #chatEditor [toolbarSettings]='tools' [height]="'150px'"
                        [maxLength]='1024' (change)="onEditorChange(chatEditor.value)" [showCharCount]='true' placeholder="Enter">
                       </ejs-richtexteditor>
                         </div>
                      </div>
                   </div>
                <div class="modal-footer">
                    <button type="submit" [disabled]="defaultMessageForm.invalid" [class.disabled]="defaultMessageForm.invalid" class="account-btn">Save</button>
                </div>
            </form>
            </div>
        </div>
    </div>

    <div class="sideBar" *ngIf="showSideBar" >
        <div class="sidebar-close">
            <button type="button" class="btn-close" (click)="showSideBar = false">
                <img src="../../../../assets/img/teambox/icon-close.svg">
            </button>
        </div>
        <div class="sidebar-content">
            <div class="d-flex pt-5 px-5">
                <span *ngIf="selectedMessageData.Is_disable == 0" class="enable">Enable</span>
                <span *ngIf="selectedMessageData.Is_disable == 1 || selectedMessageData.Is_disable == null" 
                       class="disable">Disabled</span>
            </div>
           
                <div class="p-3">
                   Created On: {{selectedMessageData.Created_at | date:'h:mm a, dd MMM yyyy'}}
                    <div class="pt-1">
                   Modified On: {{selectedMessageData.updated_at | date:'h:mm a, dd MMM yyyy'}}
                    </div>
                </div>    
            <div class="flex-column pt-4">
                <div class="heading w-50">
                  {{selectedMessageData.title}}
                </div>
                <div class="description">
                  <p>{{selectedMessageData.description}}</p>
                </div>
            </div>
            <div *ngIf="selectedMessageData.override==null" class="flex-row  pt-4">
                <div class="condition">
                 <img src="../../../../assets/img/settings/checked.svg" />
                </div>
                <div class="">
                    <p>Override keyword match and always send this ‘{{selectedMessageData.title}}’ message</p>
                </div>
            </div>
            <div class="flex-column  pt-4">
                <div class="w-50">
                   <img src="" />
                </div>
                <div class="bodydata w-45">
                    <div *ngIf="selectedMessageData.message_type == 'image'" class="message_type" 
                           [ngStyle]="{'background-image': 'url(' + selectedMessageData.link + ')'}">
                    </div> 
                    <div *ngIf="selectedMessageData.message_type == 'video'" class="message_type" [ngClass]="{'vid':selectedMessageData.message_type=='video'}">
                        <video controls id="video-background" [src]="selectedMessageData.link" type="video/mp4"></video>
                    </div>
                    <div *ngIf="selectedMessageData.message_type == 'document'" class="message_type">
                        <div class="doc-preview" *ngIf="selectedMessageData.link" width="100%" height="150px">
                          <a [href]="selectedMessageData.link"><img src="../../../../assets/img/settings/doc.svg" />
                        </a>
                        </div>
                    </div>
                  <div class="message_data" [innerHTML]=" selectedMessageData.value" 
                      [ngClass]="{'preview': selectedMessageData.message_type === 'text'}">
                </div>
                </div>
            </div>
        </div>
        <div class="sideBar-footer">
            <button type="button" class="account-white-btn" data-bs-toggle="modal" data-bs-target="#userModal">
                <img class="p-0" src="../../../../assets/img/edit.png"></button>
            <button type="button" class="account-white-btn ml-2" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <img class="p-0" src="../../../../assets/img/delete.png">
            </button>
            <button class="disable-btn ml-2">
                <span>Enable</span>
                <label class="switch">
                    <input type="checkbox" class="form-control-checkbox">
                    <span class="slider 1"></span>
                </label>
            </button>
        </div>
    </div>

</div>

<div class="modal fade" tabindex="-1" id="atrributemodal" #atrributemodal data-bs-backdrop="static" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="attrmodal modal-content">
            <div class="modal-body">
                <div class="custom_modal bg-pink sm attributes">
                    <div class="modal-header">
                        <div class="modal-header-left">
                            <h4 class="modal-title" id="modal-basic-title">Attributes</h4>
                        </div>
                        <div class="modal-header-right">
                            <p (click)="closeAtrrModal()" class="close-box" aria-label="Close"><img src="assets/img/teambox/icon-close.svg"></p>
                        </div>
                    </div>
                    <div class="modal-body quickResponse">
                        <input class="search-box" type="text" placeholder="Search" aria-label="Search"
                            aria-describedby="basic-addon2" [(ngModel)]="attributesearch" />
                        <div class="items_list">
                            <div *ngFor="let alist of attributesList | searchfilter:attributesearch " class="attribute">
                                <p class="label"><img src="assets/img/teambox/attribute.svg"> {{alist}}</p>
                            </div>
                        </div>

                        <div class="bottom_section">
                            <p class="text-box-readonly"><span><img class="setting_icon px-2" src="../../../../assets/img/profile/Info.svg">
                            </span>Add/edit new attributes from settings</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
