<sb-layout-dashboard>
	<sb-top-nav title="Funnel"></sb-top-nav>
	  <div class="campaigns_page">

		<div class="toaster">
		</div>

		<div class="header campaigns_section">

			<div class="campaigns_page_left">
				<input type="text" placeholder="Search" aria-label="Search" class="search-box"
					aria-describedby="basic-addon2" />
			</div>
			<div class="campaigns_page_right">
				<div class="drop-down-btn">
					<div class="toggle-box" (click)="filterChannels(filterchannels)">
						<img src="assets/img/teambox/filter-icon.svg">
						<span>Filter</span>
					</div>

				</div>
				<ng-template #filterchannels let-c="close" let-d="dismiss">
					<div class="modal-content m-0 p-3 filterchannels">
						<div class="modal-header align-items-center filterchannelsheader">
							<div class="modal-header-left ">
								<p class="m-0">Filter By Channels</p>
							</div>
							<div class="modal-header-right">
								<p class="m-0 close-box" aria-label="Close" (click)="d('Cross click')"><img
										src="assets/img/teambox/icon-close.svg"></p>
							</div>
						</div>
						<div class="modal-body px-5 filterchannelsbody">
							<div class="form-check pb-4">
								<input type="radio" class="form-check-input" id="radio1" name="optradio"
									value="option1">WhatsApp Official
								<label class="form-check-label" for="radio1"></label>
							</div>
							<div class="form-check">
								<input type="radio" class="form-check-input" id="radio2" name="optradio" value="option2"
									checked>WhatsApp Web
								<label class="form-check-label" for="radio2"></label>
							</div>

						</div>
						<div class="modal-footer filterchannelsfooter">
							<button type="button" class="submit-btn" aria-label="Close">Apply</button>
						</div>
					</div>

				</ng-template>
				<button class="new-message-btn" (click)="openAddNew(addNewCampaign)">
					<img class="icon" src="/assets/img/teambox/add.svg"/>New Funnel
				</button>
			</div>

			<div *ngIf="" class="campaigns_section_items no-campaign">
				<img src="../../../../assets/no-funnel.png">
				<p>No Funnel</p>
				<p><span>Lorium ipsum dolor sit amet</span></p>
			</div>

			<div *ngIf="true" class="campaigns_section">
				<div class="campaigns_section_items">
					<div class="campaigns_section_item" (click)="toggleCampaign()">
						<div class="campaigns_section_item_header">
							<label>Published</label>
							<span>Id: 10051</span>
						</div>
						<div class="funnel-title">Gift Card Black Friday</div>
						<p class="mt-1"><img class="icon" src="/assets/img/teambox/whatsapp-icon-l.svg" />WhatsApp
							Official</p>
						<div class="campaigns_section_item_statics d-flex Messages pt-3">
							<div>
								<div class="di-num">5</div>
								<div class="di-mess">Messages</div>
							</div>
							<div class="col-2"></div>
							<div>
								<div class="di-num">875</div>
								<div class="di-mess">Subscribers</div>
							</div>
						</div>
						<div class="Finished d-flex pt-3">
							<div>
								<div class="di-num">248</div>
								<div class="di-mess">Finished</div>
							</div>
							<div class="col-2"></div>
							<div class="pl-2">
								<div class="di-num">302 </div>
								<div class="di-mess">Success</div>
							</div>
						</div>
						<div class="lost pt-3">
							<div class="di-num">
								98
							</div>
							<div class="di-mess"> Lost</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="campdetails" id="funnside">
			<div *ngIf="funnelDetail" class="campaign_detail" id="sidebar">
				<button type="button" class="btn5 btn-close" (click)="funnelDetail=false">
					<img src="assets/img/teambox/icon-close.svg">
				</button>
				<div class="collumn d-flex">
					<div class="funnelheader">
						<label class="pub">Published</label>
						<span>Id: 10051</span>
					</div>
					<div class="line"></div>
					<h6>Created on:</h6>
					<!-- <h5>{{repliesData.CreatedDate  | date: 'dd MMM yyyy'}}</h5> -->
					<div class="line"></div>
					<h6>Edited on:</h6>
					<!-- <h5>{{repliesData.ModifiedDate | date: 'dd MMM yyyy' }}</h5> -->
				</div>
				<h4 class="help-support-btn" routerLink="/dashboard/support"><img id="Edit-icon"
						src="assets/img/Edit-icon.png">Gift Card Black Friday</h4>UIlabore et dolore magna aliqua. Ut
				enim ad minim veniam, quis nostrud exercitation
				<div class="row d-flex">
					<p class="mt-1"><img class="icon" src="/assets/img/teambox/whatsapp-icon-l.svg" />WhatsApp Official
					</p>
					<h6 class="text-justify"></h6>
				</div>
				<h3 class="keywords-btn" data-bs-toggle="modal" data-bs-target="#smartrepliesModal"><img id="Edit-icon"
						src="assets/img/Edit-icon.png">Subscribers</h3>
				<div>604 ( From existing Contacts + On New Contact Creation + On Attribute Update)</div>
				<div class="row">
					<div class="box">
						<p></p>
					</div>
				</div>
				<div class="box1 d-flex">
					<h6>Matching Criteria:</h6>
					<h5></h5>
				</div>
				<h3 class="reply-action-btn"><img id="Edit-icon" src="assets/img/Edit-icon.png">Message</h3>
				<div>
					<div class="box4">
						<div>1st Message</div>
						<p></p>
					</div>
					<div class="assign-conversation">
						<p class="m-0 py-1 px-2" id="msgbox-head1">Action</p>
						<div class="d-flex flex-wrap assign-container">Message
							<p class="py-1 px-2 m-0" id="msgbox-body1"><b>Product Launch </b>Message</p>
							<p class="py-1 m-0" id="msgbox-body2">1 Day 5 Hrs 15 Mins after funnel subscription</p>
						</div>
					</div>
				</div>

				<div class="footer">
					<button class="delete-btn" data-bs-toggle="modal" data-bs-target="#Delete"><img
						src="assets/img/delete.png"></button>
				</div>
			</div>
		</div>

		<ng-template #addNewCampaign class="addNewCampaign" let-c="close" let-d="dismiss">		
			<div class="modal-header">
				<div class="modal-header-left">
					<h4 class="modal-title" id="modal-basic-title">New Funnel</h4>
				</div>
				<div class="modal-header-right">
					<p class="close-box" aria-label="Close" (click)="d('Cross click')"><img src="assets/img/teambox/icon-close.svg"></p>
				</div>
				</div>
			<div class="modal-body">
				
				<div class="addeidtcampaign_menu">
					<div class="addeidtcampaign_menu_item">
						<img *ngIf="activeStep > 1" class="icon" src="assets/img/campaign/back.svg" (click)="prevStep()">
					</div>
					<div [ngClass]="activeStep > 0 ? 'addeidtcampaign_menu_item active' : 'addeidtcampaign_menu_item'" (click)="setStep(1)" ><span>1</span><p>Add Name & Channel</p></div>
					<div class="addeidtcampaign_menu_item_dotted"><p></p></div>
					<div [ngClass]="activeStep > 1 ? 'addeidtcampaign_menu_item active' : 'addeidtcampaign_menu_item'"  (click)="setStep(2)"><span>2</span><p>Subscriber Conditions</p></div>
					<div class="addeidtcampaign_menu_item_dotted"><p></p></div>
					<div [ngClass]="activeStep > 2 ? 'addeidtcampaign_menu_item active' : 'addeidtcampaign_menu_item'"  (click)="setStep(3)"><span>3</span><p>Add Message & Schedule</p></div>
					<div class="addeidtcampaign_menu_item_dotted"><p></p></div>
					<div [ngClass]="activeStep > 3 ? 'addeidtcampaign_menu_item active' : 'addeidtcampaign_menu_item'"  (click)="setStep(4)"><span>4</span><p>Review & Publish</p></div>
					<div class="addeidtcampaign_menu_item"></div>
				</div>
	
				<div [ngClass]="activeStep ==1 ? 'addeidtcampaign_step active' : 'addeidtcampaign_step'">
					<div class="innerbox bg_pink">
					<!-- <form [formGroup]="newfFunnelDetail"> -->
						<div class="formrow">
							<label for="name" class="required">Funnel Name <span class="text-danger">*</span></label>
							<input class="form-control" type="text" placeholder="Enter title in max 20 character" name="title"
									formControlName="title"  maxlength="20"  id="title" />
						</div>
						<div class="formrow">
							<label for="name" class="required">Description</label>
							<textarea class="textarea form-control" placeholder="Enter description in max 80 character" name="description"
									formControlName="description" rows="3" maxlength="80"  id="description"></textarea>
						</div>
	
						<div class="formrow">
							<label for="Channel" class="required">Channel <span class="text-danger">*</span></label>
							<input class="form-control select_box" type="text" placeholder="Select channel" name="channel_label"
									formControlName="channel_label" id="channel_label" (click)="toggleChannelOption()" readonly />
							<div *ngIf="ShowChannelOption" (click)="stopPropagation($event)" class="popup-dialog">
								<p *ngFor="let channel of channelOption ;let i = index" class="label" (click)="selectChannel(channel)">
									{{channel.label}}
								</p>
							</div>
							<div *ngIf="ShowChannelOption" class="overlay" (click)="closeAddActionDialog()"></div>
						</div>
					<!-- </form> -->
					</div>
				</div>

				<div [ngClass]="activeStep ==2 ? 'addeidtcampaign_step active' : 'addeidtcampaign_step'">
					<div class="subscriber-condition-cards">
							<div class="funnel-add-head">Funnel Addition (Minimum one required)</div>
							<div class="outer_box">
								<div class="inner_box">
									<div class="d-flex justify-content-between">
										<img src="../../../../assets/img/funnel/from-existing.svg" alt="error-img" /> <input type="checkbox" />
									</div>
									<p>From Existing Contacts</p>
									<span>(Select from Saved Lists or create new)</span>
									<img src="../../../../assets/img/support/arrow.svg" alt="error-img">
								</div>
							</div>
					</div>
				</div>

				<div [ngClass]="activeStep >2 && activeStep <4 ? 'addeidtcampaign_step active' : 'addeidtcampaign_step'">
					<div *ngIf="activeStep==3" class="full_width">
						<div class="section_header">
							<div class="inner">
							<p class="heading">Add Template</p>
							<p><span>Select a message to create campaign</span></p>
							</div>
							<div class="inner right">
								<input placeholder="Search" type="text" class="search-box" (keyup)="searchTemplate($event)">
							</div>
						</div>
						<div class="section_filter">
							<label class="container">
								<input checked type="checkbox" name="template_filter" value="Marketing" (click)="filterTemplate($event)">
								<span class="checkmark"></span>
								<p><span>Marketing</span></p>
							</label>
							<label class="container">
								<input checked type="checkbox" name="template_filter" value="Utility" (click)="filterTemplate($event)">
								<span class="checkmark"></span>
								<p><span>Utility</span></p>
							</label>
							<label class="container">
								<input checked type="checkbox" name="template_filter" value="Authentication" (click)="filterTemplate($event)">
								<span class="checkmark"></span>
								<p><span>Authentication</span></p>
							</label>
						
						</div>
						<div class="template_list">
							<div class="template_box" *ngFor='let template of allTemplates ;let i = index'>
								<label class="container" (click)="selectTemplate(template)">
									<input type="radio" name="selectedTemplate">
									<span class="checkmark radio"></span>
									<div class="template_body">
										<p>{{template.TemplateName}}</p>
									<p><span>{{template.created_at | date:'dd-MM-yyyy'}}</span></p>
									</div>
								</label>
								
								<div class="inner_box">
								 <div class="doc-preview"*ngIf="template.media_type=='document'" width="100%" height="150px">
									<a [href]="template.Links"><img src="../../../../assets/img/settings/doc.svg" /></a>
									</div>
									<video *ngIf="template.media_type=='video'" muted id="video-background" [src]="template.Links"></video>
									<img *ngIf="template.media_type=='image'" class="template_img" src="{{template.Links}}">
									<div *ngIf="!template.media_type" class="template_img_placeholder"></div>
									<div class="template_text">
										<p [innerHTML]="template.Header" class="m-0 font-weight-bold"></p>
										<p [innerHTML]="template.BodyText"></p>
										<p [innerHTML]="template.FooterText"></p>
									  </div>
								</div>
	
								<div class="template_btn">
									<!-- <button type="button" class="btn">YES</button>
									<button type="button" class="btn">NO</button>
									<button type="button" class="btn">EXPLORE</button> -->
						
								</div>
								 
							</div>
	
						</div>
					</div>
					<div *ngIf="activeStep==3.1" class="full_width_row">
						<div class="template_details_section">
							<div class="template_details_section_left">
								<p>{{selectedTemplate.TemplateName}}</p>
								<div class="template">
									<div class="template_img">
										<div class="doc-preview"*ngIf="selectedTemplate.media_type=='document'">
											<a [href]="selectedTemplate.Links"><img src="../../../../assets/img/settings/doc.svg" /></a>
										  </div>
										<video *ngIf="selectedTemplate.media_type=='video'" autoplay muted id="video-background" [src]="selectedTemplate.Links"></video>
										<img *ngIf="selectedTemplate.media_type=='image'" class="template_img" src="{{selectedTemplate.Links}}">
										<div *ngIf="!selectedTemplate.media_type" class="template_img_placeholder"></div>
									</div>
									<div class="template_text">
										<p [innerHTML]="selectedTemplate.Header" class="name"></p>
										<p [innerHTML]="selectedTemplate.BodyText" class="description"></p>
										<p [innerHTML]="selectedTemplate.FooterText" class="footer"></p>
									</div>
			
								</div>
								<div class="template_btn">
									<!-- <button type="button" class="btn">YES</button>
									<button type="button" class="btn">NO</button>
									<button type="button" class="btn">EXPLORE</button> -->
						
								</div>
							</div>
							
							<div class="template_details_section_right">
								<p class="mt-2">Variable value<img class="icon sm" src="/assets/img/campaign/Info.svg"> </p>
								
								<div class="form_row" *ngFor='let variable of selectedTemplate.allVariables ;let i = index' >
									<label>{{variable.label}} </label>
									<div>
										<p class="form-control" *ngIf="segmentsContactList.length>0">
											<input type="text" class="form-control inner" value={{variable.value}} (keyup)="updateAttributeValue($event,variable)" placeholder="Input value or add attribute">
										</p>
										<p class="form-control" *ngIf="csvContactList.length>0" >
											<input type="text" class="form-control inner" value={{variable.value}} (keyup)="updateAttributeValue($event,variable)" placeholder="Input value or add attribute">
											<!-- <span class="map_attribute" (click)="openMapOption(variable)">Map</span> -->
										</p>
	
										<div *ngIf="csvContactList.length>0 && selecetdVariable.label==variable.label && selecetdVariable.selected" class="popup-dialog">
											<p class="label">Map the column</p>
										</div>
								</div>
								</div>
								
								
								<p class="mt-2">Button Payload <span>(Optional)</span><img class="icon sm" src="/assets/img/campaign/Info.svg"></p>
								<div class="form_row" >
									<label>Yes</label>
									<input type="text" class="form-control" value={{selectedTemplate.button_yes}} (keyup)="updateButtonsValue($event,'button_yes')" placeholder="Input payload value">
								</div>
								<div class="form_row">
									<label>No</label>
									<input type="text" class="form-control" value={{selectedTemplate.button_no}} (keyup)="updateButtonsValue($event,'button_no')" placeholder="Input payload value">
								</div>
								<div class="form_row">
									<label>Explore</label>
									<input type="text" class="form-control" value={{selectedTemplate.button_exp}} (keyup)="updateButtonsValue($event,'button_exp')" placeholder="Input payload value">
								</div>
							</div>
						</div>
					</div>
	
					<div *ngIf="activeStep==3" class="full_width_row">
							<div class="template_details_section_left">
								<p>{{selectedTemplate.TemplateName}}</p>
								<div class="template">
									<div class="template_img">
										<p class="close-box"><img src="/assets/img/campaign/edit.svg"></p>
										<img *ngIf="selectedTemplate.media_type=='image'" class="template_img" src="{{selectedTemplate.Links}}">
										<video *ngIf="selectedTemplate.media_type=='video'" muted id="video-background" [src]="selectedTemplate.Links"></video>
										<div class="doc-preview"*ngIf="selectedTemplate.media_type=='document'" width="100%" height="150px">
											<a [href]="selectedTemplate.Links"><img src="../../../../assets/img/settings/doc.svg" /></a>
										  </div>
										<div *ngIf="!selectedTemplate.media_type" class="template_img_placeholder"></div>
									</div>
									<div class="template_text">
										<p [innerHTML]="selectedTemplate.TemplateName" class="name"></p>
										<p [innerHTML]="selectedTemplate.BodyText" class="description"></p>
										<p [innerHTML]="selectedTemplate.FooterText" class="footer"></p>
									</div>
			
								</div>
								
							</div>
							
							
					</div>
					
				</div>
	
				<div [ngClass]="activeStep ==3.1 ? 'addeidtcampaign_step active' : 'addeidtcampaign_step'">
					<div class="campaign_preview">
						<div class="campaign_preview_left">
							<p class="label">Summery</p>
							<p class="heading">{{newCampaignDetail.value.title}}</p>
							<p><img *ngIf="newCampaignDetail.value.channel_id ==1" class="icon" src="/assets/img/teambox/whatsapp-icon-l.svg" />{{newCampaignDetail.value.channel_label}}</p>
							<p class="label mt-3">Traget Audience</p>
							<p *ngIf="segmentsContactList.length > 0" class="value">{{segmentsContactList.length}} <span>( Segment Audience)</span></p>
							<p *ngIf="csvContactList.length > 0" class="value">{{csvContactList.length}} <span>( Imported Contacts)</span></p>
							<p class="label mt-3">Message</p>
							<p class=" mt-3">Category</p>
							<p class="value">{{selectedTemplate.Category}}</p>
							<div class="template mt-2">
								<div class="template_img">
									<div class="doc-preview"*ngIf="selectedTemplate.media_type=='document'" width="100%" height="150px">
										<a [href]="selectedTemplate.Links"><img src="../../../../assets/img/settings/doc.svg" /></a>
									  </div>
									<video *ngIf="selectedTemplate.media_type=='video'" muted id="video-background" [src]="selectedTemplate.Links"></video>
									<img *ngIf="selectedTemplate.media_type=='image'" class="template_img" src="{{selectedTemplate.Links}}">
									<div *ngIf="!selectedTemplate.media_type" class="template_img_placeholder"></div>
								</div>
								<div class="template_text">
									<p [innerHTML]="selectedTemplate.TemplateName" class="name"></p>
									<p [innerHTML]="selectedTemplate.BodyText" class="description"></p>
									<p [innerHTML]="selectedTemplate.FooterText" class="footer"></p>
								</div>
		
							</div>
							<div class="template_btn">
								<button type="button" class="btn">YES</button>
								<button type="button" class="btn">NO</button>
								<button type="button" class="btn">EXPLORE</button>
							</div>
							<p class="sub_title_lg blackcolor dropdown mb-2">Advance Options<img *ngIf="" class="icon" src="/assets/img/teambox/down-aarow.svg"><img *ngIf="" class="icon" src="/assets/img/teambox/up-aarow.svg"></p>
								<div>
								<p class="sub_title_sm blackcolor">Variable Values</p>
								<div class="btn_group" *ngFor='let variable of selectedTemplate?.allVariables ;let i = index' >
									<input type="text" value={{variable.label}} /> {{variable.value}}
								</div>
								<p class="sub_title_sm blackcolor mt-2 mb-2">Button Payload</p>
								<div class="btn_group"><input type="text" value="YES" /> {{selectedTemplate?.button_yes}}</div>
								<div class="btn_group"><input type="text" value="No" /> {{selectedTemplate.button_no}}</div>
								<div class="btn_group"><input type="text" value="EXPLORE" /> {{selectedTemplate.button_exp}}</div>
								</div>
	
						</div>
						<div class="campaign_preview_right">
							<p>Schedule</p>
							<div class="container_row">
							<label class="container">
								<input type="radio" name="schedule" value="0" checked>
								<span class="checkmark radio"></span>
								<p><span>Start Now</span></p>
							</label>
							<label class="container" >
								<input type="radio" name="schedule" value="1">
								<span class="checkmark radio"></span>
								<p><span>Schedule Later</span></p>
							</label>
							</div>
							<div class="middel_section_outer">
								<div  class="middel_section">
									<div class="formrow">
										<p>Time Zone</p>
										<p class="form-control select_box btn"></p>
										<div  class="popup-dialog">
											<p class="label">Zone</p>
											
										</div>
									</div>
									
									<div class="formrow">
										<p>Schedule Date</p>
										<input type="date" class="form-control btn white_bg" value=>
									</div>
	
									<div class="formrow">
										<p>Schedule Time</p>
										<input  type="time" class="form-control btn white_bg" value=>
									</div>
								</div>
							</div>
							<div class="bottom_section">
								<p class="form-control" >Test Campaign</p>
							</div>
							<div class="bottom_section">
							<p class="close-box"><img class="setting_icon" src="/assets/img/campaign/setting-g.svg"></p>
							<p class="text-box-readonly">To configure no. from settings</p>
							</div>
						</div>
					
					</div>
				</div>


				<div class="input_group_btn">
					<button type="button" class="main-modal submit-btn" >Next</button>
					<!-- (click)="nextStep()" -->
					<!-- <button *ngIf="activeStep == 4" type="button" class="submit-btn" (click)="ConfirmCampaignSchedule(ConfirmCampaign)">Done</button> -->
				</div>
	
				
				
			</div>
	
		</ng-template>

    </div>

</sb-layout-dashboard>